---
title: "New code on cholera analysis_20250405"
author: "Selemani Ngwira"
date: "2024-12-16"
output: word_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# loading packages, first load the pacman package using a logic code

if(!require(pacman)) install.packages("pacman")

p_load(
  tidyverse,
  here,
  summarytools,
  janitor,
  sf, 
  tmap,
  OpenStreetMap,
  flextable,
  rio, 
  gtsummary, 
  epikit
)


conflicted::conflicts_prefer(dplyr::filter)
conflicted::conflicts_prefer(flextable::align)

 
```


# loading data

```{r echo=FALSE}

# importing the data 
cholera_data<- import( here("data/cholera_data_.csv")) %>%
                clean_names() %>% 
  mutate(district=recode(
      district, 
      "Blantyre_City"="Blantyre"
    ))%>% 
   mutate(residence = case_when(
district %in% c("Lilongwe", "Blantyre", "Dedza", "Bakala") ~ "In land",
    TRUE ~ "lake shore" )) 

# changing the data.frame into tibble object for easy handling 
cholera_data<- tibble(cholera_data)


# filtering out those less than 18 years 
cholera_data<-cholera_data %>% 
  filter(age_group!="<18")

ta_shapefile<-st_read(
  here("data/MWI_adm1.shp")
) %>% 
  select(
   NAME_1,
    ID_0,
    ID_1) %>% 
  dplyr::rename(
    "District"= NAME_1
  )


```

# Social and behavioral factors that influence current water treatment practices

### Awareness of the Health Risk Associated with drinking untreated Water by Sex, Age-Group, Level of Education,  and District 

```{r echo=FALSE}

awareness_of_heathRisk<-cholera_data %>% 
                 select(
                   sex, 
                   age_group, 
                   level_education, 
                   district,
                   residence
                  ,
           health_risk_associated_with_drinking_untreated_water
                 )


awareness_of_heathRisk %>% 
          # select(-district , -zone) %>%
  tbl_summary(health_risk_associated_with_drinking_untreated_water,
            percent = "row",
            digits = list(
              sex ~ c(0, 1),
              age_group ~ c(0, 1),
              level_education ~ c(0, 1), 
              district ~ c(0, 1),
              residence ~ c(0, 1)
            ))

```


### 2.3. 0 Main sources of drinking water during the dry season by District/ Township 

```{r echo=FALSE}
drinking_dry<-cholera_data %>% 
  select(district, 
         residence, 
         main_source_of_drinking_water_dry_season)


drinking_dry<- drinking_dry %>% 
  group_by( district, 
            main_source_of_drinking_water_dry_season) %>%
  count(main_source_of_drinking_water_dry_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_dry_season, 
    values_from = n
  )

# replacing NA with Zero 
drinking_dry[is.na(drinking_dry)]<-0


main_source_table<- drinking_dry %>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         percentage=round(community_standpipe/total*100, 2),
          community_standpipe=paste0(community_standpipe,
                                   " (", round(percentage, 1), "%)"),
        percentage=round(borehole_1/total*100, 2 ),
        borehole_1=paste0(borehole_1, " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_dwelling/total*100, 2),
                 piped_into_dwelling=paste0(piped_into_dwelling,
                                   " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_yard_plot/total*100, 2),
                 piped_into_yard_plot=paste0(piped_into_yard_plot,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(protected_well_1/total*100, 2), 
           protected_well_1=paste0(protected_well_1,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(unprotected_well_1/total*100, 2),
           unprotected_well_1=paste0(unprotected_well_1,
                                   " (", round(percentage, 1), "%)"),
                   percentage=round(other_drinking_source/total*100, 2),
              other_drinking_source=paste0(other_drinking_source,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(river_stream/total*100, 2), 
              river_stream=paste0(river_stream,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(spring_1/total*100, 2), 
       spring_1=paste0(spring_1, " (", round(percentage, 1), "%)"),
         percentage=round(dam/total/100, 2), 
      dam=paste0(dam, " (", round(percentage, 1), "%)"),
         percentage=round(bottled_water/total*100, 2), 
   bottled_water=paste0(bottled_water, " (", round(percentage, 1), "%)"),
         percentage=round(tanker_truck_bower/total*100, 2), 
tanker_truck_bower=paste0(tanker_truck_bower,
                          " (", round(percentage, 1), "%)"),
         percentage=round(lake/total*100, 2),
    lake=paste0(lake, " (", round(percentage, 1), "%)")
         )

main_source_table %>% 
  rename_with(~ str_replace_all(., "_", " ")) %>% 
    rename_with(~ str_replace_all(., "1", "")) %>% 
  select(-total, -percentage) %>%
    as_flextable() %>% 
 flextable::rotate(j = c(2:14), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)



drinking_dry_redience<-cholera_data %>% 
  select(residence, 
         main_source_of_drinking_water_dry_season)

drinking_dry_redience<- drinking_dry_redience%>% 
  group_by( residence,
           main_source_of_drinking_water_dry_season) %>%
  count(main_source_of_drinking_water_dry_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_dry_season, 
    values_from = n
  )


# replacing NA with Zero 
drinking_dry_redience[is.na(drinking_dry_redience)]<-0



    table5<- drinking_dry_redience %>% 
      rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
      percentage=round(community_standpipe/total*100, 2),
          community_standpipe=paste0(community_standpipe,
                                   " (", round(percentage, 1), "%)"),
        percentage=round(borehole_1/total*100, 2 ),
        borehole_1=paste0(borehole_1, " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_dwelling/total*100, 2),
                 piped_into_dwelling=paste0(piped_into_dwelling,
                                   " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_yard_plot/total*100, 2),
                 piped_into_yard_plot=paste0(piped_into_yard_plot,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(protected_well_1/total*100, 2), 
           protected_well_1=paste0(protected_well_1,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(unprotected_well_1/total*100, 2),
           unprotected_well_1=paste0(unprotected_well_1,
                                   " (", round(percentage, 1), "%)"),
                   percentage=round(other_drinking_source/total*100, 2),
              other_drinking_source=paste0(other_drinking_source,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(river_stream/total*100, 2), 
              river_stream=paste0(river_stream,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(spring_1/total*100, 2), 
       spring_1=paste0(spring_1, " (", round(percentage, 1), "%)"),
         percentage=round(dam/total/100, 2), 
      dam=paste0(dam, " (", round(percentage, 1), "%)"),
         percentage=round(bottled_water/total*100, 2), 
   bottled_water=paste0(bottled_water, " (", round(percentage, 1), "%)"),
         percentage=round(tanker_truck_bower/total*100, 2), 
tanker_truck_bower=paste0(tanker_truck_bower,
                          " (", round(percentage, 1), "%)"),
         percentage=round(lake/total*100, 2),
    lake=paste0(lake, " (", round(percentage, 1), "%)")
         )
         
         
table5 %>% 
  rename_with(~ str_replace_all(., "_", " ")) %>% 
    rename_with(~ str_replace_all(., "1", "")) %>% 
  select(-total, -percentage) %>%
    as_flextable() %>% 
 flextable::rotate(j = c(2:14), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)
    



```


## 2.4. 0 Main sources of drinking water during the wet season by District

```{r echo=FALSE}

wet_drink_district <- cholera_data %>% 
                      select(district, 
                             main_source_of_drinking_water_wet_season)


wet_drink_district<- wet_drink_district %>% 
  group_by( district, 
           main_source_of_drinking_water_wet_season) %>%
  count(main_source_of_drinking_water_wet_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_wet_season, 
    values_from = n
  )




# replacing NA with Zero 
wet_drink_district[is.na(wet_drink_district)]<-0


table6<- wet_drink_district %>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         community_standpipe=round(community_standpipe/total*100, 2), 
         borehole_1=round(borehole_1/total*100, 2 ), 
         piped_into_dwelling= round(piped_into_dwelling/total*100, 2), 
         piped_into_yard_plot= round(piped_into_yard_plot/total*100, 2), 
         protected_well_1=round(protected_well_1/total*100, 2), 
         unprotected_well_1=round(unprotected_well_1/total*100, 2), 
         other_drinking_source=round(other_drinking_source/total*100, 2), 
         river_stream=round(river_stream/total*100, 2), 
         spring_1=round(spring_1/total*100, 2), 
         dam=round(dam/total/100, 2), 
         bottled_water=round(bottled_water/total*100, 2), 
         tanker_truck_bower=round(tanker_truck_bower/total*100, 2), 
         lake=round(lake/total*100, 2)
         
         )


   table6<-table6 %>%
  rename_with(~ str_replace_all(., "_", " "))
   
       
table6<- table6 %>% 
  as_flextable()


save_as_docx(table6, path = here("output/table6.docx"))







# by Zone 


wet_drink_zone <- cholera_data %>% 
                      select(zone, 
                             main_source_of_drinking_water_wet_season)


wet_drink_zone<- wet_drink_zone %>% 
  group_by( zone, 
           main_source_of_drinking_water_wet_season) %>%
  count(main_source_of_drinking_water_wet_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_wet_season, 
    values_from = n
  )




# replacing NA with Zero 
wet_drink_zone[is.na(wet_drink_zone)]<-0


table7<- wet_drink_zone%>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         community_standpipe=round(community_standpipe/total*100, 2), 
         borehole_1=round(borehole_1/total*100, 2 ), 
         piped_into_dwelling= round(piped_into_dwelling/total*100, 2), 
         piped_into_yard_plot= round(piped_into_yard_plot/total*100, 2), 
         protected_well_1=round(protected_well_1/total*100, 2), 
         unprotected_well_1=round(unprotected_well_1/total*100, 2), 
         other_drinking_source=round(other_drinking_source/total*100, 2), 
         river_stream=round(river_stream/total*100, 2), 
         spring_1=round(spring_1/total*100, 2), 
         dam=round(dam/total/100, 2), 
         bottled_water=round(bottled_water/total*100, 2), 
         tanker_truck_bower=round(tanker_truck_bower/total*100, 2), 
         lake=round(lake/total*100, 2)
         
         )


   table7<-table7 %>%
  rename_with(~ str_replace_all(., "_", " "))
   
       
table7<- table7 %>% 
  as_flextable()


save_as_docx(table7, path = here("output/table7.docx"))

```

## 2.5.1 Water Treatment at Household by Sex, Level of Education, Religion

```{r echo=FALSE}

Water_treat<-cholera_data %>% 
         select(sex, 
                age_group, 
                level_education, 
                religion, 
                treat_drinking_water)


table8<- Water_treat %>% 
  tbl_summary(treat_drinking_water, 
              percent = "row", 
              digits = list(
                sex~ c(0, 2), 
                age_group~c(0,2), 
                level_education~ c(0,2), 
                religion~c(0,2)
              ))

table8<- table8 %>% 
  as_flex_table()


save_as_docx(table8, path = here("output/table8.docx"))


```


## 2.5.2 Water Treatment at Household by District 

```{r echo=FALSE}
 


# Water_treat_district_zone<-cholera_data %>% 
#          select(district, 
#                 zone, 
#                 treat_drinking_water)
# 
# 
# table9<- Water_treat_district_zone%>% 
#   tbl_summary(treat_drinking_water, 
#               percent = "row", 
#               digits = list(
#                 district~ c(0, 2), 
#                 zone~c(0,2)
#                 
#               ))
# 
# table9<- table9 %>% 
#   as_flex_table()
# 
# 
# save_as_docx(table9, path = here("output/table9.docx"))

```


## 2.5.3 if yes, Methods of water treatment by District

```{r fig.height=7, fig.width=14, include=FALSE}
# methods_water <- cholera_data %>% 
#                select(
#                  #sex,
#                   # age_group, 
#                   # level_education, 
#                   religion, 
#                  c(34:41)
#                )
# 
# 
# religion_table<- methods_water %>% 
#   pivot_longer(
#     cols = (2:9)
#   ) %>% 
#   drop_na(value) %>% 
#   group_by(
#     # sex, 
#      # age_group, 
#     # level_education, 
#      religion, 
#     name) %>% 
#   summarise(value=sum(value)) %>% 
#   pivot_wider(
#     names_from = name, 
#   values_from = value, 
#   ) %>% 
#   group_by(
#     religion
#   ) %>% 
#   rowwise() %>% 
#   mutate(total=sum(across(where(is.numeric))))
# 
# 
# sex_table<- sex_table %>% 
#   rename(
#     "variable"=sex
#   )
# 
# age_group_table<- age_group_table %>% 
#   rename(
#     "variable"=age_group
#   )
# 
# 
# education_table<- education_table %>% 
#   rename(
#     "variable"=level_education
#   )
# 
# 
# religion_table<- religion_table %>% 
#   rename(
#     "variable"=religion
#   )
# 
# 
# # Combine all tables into one
# table10 <- bind_rows(sex_table,
#                      age_group_table,
#                      education_table,
#                      religion_table)
# 
# 
# 
# table10<- table10 %>% 
#   mutate(
#  method_of_water_treatment_boiling= round(method_of_water_treatment_boiling/total*100, 2) ,         
#  method_of_water_treatment_ceramic_filter= round(method_of_water_treatment_ceramic_filter/total*100, 2),   
#  method_of_water_treatment_filter_with_cloth= round(method_of_water_treatment_filter_with_cloth/total*100, 2),
#  method_of_water_treatment_others_methods=round(method_of_water_treatment_others_methods/total*100, 2),    
#  method_of_water_treatment_solar_disinfection=round(method_of_water_treatment_solar_disinfection/total*100, 2), 
#  method_of_water_treatment_stand_settle=round(method_of_water_treatment_stand_settle/total*100, 2),     
#  method_of_water_treatment_use_chlorine= round(method_of_water_treatment_use_chlorine/total*100, 2),
#  method_of_water_treatment_use_water_from_tap=round(method_of_water_treatment_use_water_from_tap/total*100, 2) 
#     )
# 
# 
# table10<- table10 %>%
#   rename_with(~ str_replace_all(., "method_of_water_treatment_", " "))
# 
# 
# table10<- table10 %>%
#   rename_with(~ str_replace_all(., "_", " "))
# 
# 
# table10<- table10 %>% 
#   as_flextable()
# 
# 
# save_as_docx(table10, path = here("output/table10.docx"))
```


```{r include=FALSE}

methods_water_district <- cholera_data %>% 
               select(
                 district, 
                 c(34:41)
               )



tabel11<- methods_water_district %>% 
  pivot_longer(
    cols = (2:9)
  ) %>% 
  drop_na(value) %>% 
  group_by(
    district, 
    name) %>% 
  summarise(value=sum(value)) %>% 
  pivot_wider(
    names_from = name, 
  values_from = value, 
  ) %>% 
  group_by(
    district
  ) %>% 
  rowwise() %>% 
  mutate(total=sum(across(where(is.numeric))))



tabel11<- tabel11 %>% 
mutate(
 method_of_water_treatment_boiling= round(method_of_water_treatment_boiling/total*100, 2) ,         
 method_of_water_treatment_ceramic_filter= round(method_of_water_treatment_ceramic_filter/total*100, 2),   
 method_of_water_treatment_filter_with_cloth= round(method_of_water_treatment_filter_with_cloth/total*100, 2),
 method_of_water_treatment_others_methods=round(method_of_water_treatment_others_methods/total*100, 2),    
 method_of_water_treatment_solar_disinfection=round(method_of_water_treatment_solar_disinfection/total*100, 2), 
 method_of_water_treatment_stand_settle=round(method_of_water_treatment_stand_settle/total*100, 2),     
 method_of_water_treatment_use_chlorine= round(method_of_water_treatment_use_chlorine/total*100, 2),
 method_of_water_treatment_use_water_from_tap=round(method_of_water_treatment_use_water_from_tap/total*100, 2) 
    )




tabel11<- tabel11 %>%
  rename_with(~ str_replace_all(., "method_of_water_treatment_", " "))


tabel11<- tabel11 %>%
  rename_with(~ str_replace_all(., "_", " "))


tabel11<- tabel11%>% 
  as_flextable()


save_as_docx(tabel11, path = here("output/table11.docx"))

```




##2.5.4 Properly chlorination process by district.


```{r echo=TRUE}
properly_chro_district <- cholera_data %>% 
            select(district, 
                   chlorination_process_done_correctly)


table12<- properly_chro_district %>% 
  tbl_summary(chlorination_process_done_correctly, 
              percent = "row", 
              digits = list(
                district~c(0,2)
              ))


table12<- table12 %>% 
  as_flex_table()


save_as_docx(table12, path = here("output/table12.docx"))




## by Sex, Age and Education 


properly_chro_demo<- cholera_data %>% 
            select(sex,
                   age_group, 
                   level_education, 
                   religion,
                   chlorination_process_done_correctly)


table13<- properly_chro_demo %>% 
  tbl_summary(chlorination_process_done_correctly, 
              percent = "row", 
              digits = list(
              sex~c(0,2), 
                 age_group~c(0,2), 
                 level_education~c(0,2), 
                 religion~c(0,2)
              ))


table13<- table13 %>% 
  as_flex_table()


save_as_docx(table13, path = here("output/table13.docx"))


```

## 2.5. 5 Frequency of water treatment by Sex, Level of Education, Religion 

```{r include=FALSE}
freq_water_treatment <- cholera_data %>% 
                        select(
                          sex, 
                          age_group, 
                          level_education, 
                          religion, 
                          often_treat_water
                        )



table14<- freq_water_treatment %>% 
  tbl_summary(often_treat_water, 
              digits = list(
                sex~c(0,2), 
                age_group~c(0,2), 
                level_education~c(0,2), 
                religion~c(0,2)
              ))


table14<- table14 %>% 
  as_flex_table()


save_as_docx(table14, path = here("output/table14.docx"))



freq_water_treatment_district <- cholera_data %>% 
                                select(
                                  district,
                                  zone,
                                  often_treat_water
                                )


freq_water_treatment_district %>% 
          tbl_summary(often_treat_water, 
                      digits = list(
                        district~c(0,2), 
                        zone~c
                      ))



```

## 2. 5.6 Access to water treatment by district 

```{r include=FALSE}




```

## 2. 6.0 Knowledge of cholera calendar year.  By Sex, Level of Education, Religion 

```{r}




```


## 2. 7. 0 Knowledge of the potential Cause of Cholera.

```{r}





 
```

## 2.8. 0 Knowledge of the Prevention Measures of cholera by Sex, Level of Education and Religious Belief.  


```{r}





```

## 2.8. 0 Knowledge of the Prevention Measures of cholera by District 
```{r}





```


## 2. 9.0 Current local measures or campaigns in place to prevent cholera outbreaks by Districts
```{r}




```

# Social and cultural behavior determinants of vaccine uptake 


## 3.1. 0 Aware of Cholera Vaccine by  Age- Group, Sex Level of Education, and 3.1. 1 Aware of Cholera Vaccine by  District and Zone  



```{r}


 
```

## 3.2.0  Believe Cholera Vaccine Prevent Cholera by Sex, Level of Education 

```{r}



```

## 3.2.1  Believe Cholera Vaccine Prevent District and Zone 

```{r}



```

##3.3. 0 Information about Cholera Vaccine  by Sex, Age Group,  Education, Religion 

```{r}





```



## 3.3. 1 Information about Cholera Vaccine  by  District and Zone 

```{r}



```



## 3. 4. 0 Safe of Cholera Vaccine by Sex Age Group Education and Religion 

```{r}



```


##3. 4. 1 Safe of Cholera Vaccine by District and Zone 

```{r}



```

## 3. 5. 0 Community Influence decision about vaccination by District and Zone 

```{r}

              


```



## 3. 6. 0 Difficult in access cholera vaccination by Sex, Education and Religion  

```{r}







```


## 3. 6. 1 Difficult in access cholera vaccination by District 


```{r}





```



##3. 7. 0 OCV status by Sex, Age Group, Education and Religious 

```{r}

```



## 3. 7. 0 OCV status by District and Zone  

```{r}

```


## 3. 8. 0 Family Members vaccinated by District and Zone 
```{r}

```


## 3. 9. 0 Willingness to get vaccinated in the Future OCV by Sex, Age Group and Education 

```{r}

```


## 3. 9. 1 Willingness to get vaccinated in the Future OCV by District and Zone 

```{r}

```


## 3. 10. 0 Recommend a Family member to get vaccinated by District and Zone 

```{r}

```



## 3. 13. 0 Prefer ways to Receive Information about Vaccine by Sex, Age Group and Education and Religious 
```{r}

```



## 3. 13. 1 Prefer ways to Receive Information about Vaccine by District and Zone 

```{r}

```








