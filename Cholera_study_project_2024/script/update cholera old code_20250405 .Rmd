---
title: "New code on cholera analysis_20250405"
author: "Selemani Ngwira"
date: "2024-12-16"
output: word_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# loading packages, first load the pacman package using a logic code

if(!require(pacman)) install.packages("pacman")

p_load(
  tidyverse,
  here,
  summarytools,
  janitor,
  sf, 
  tmap,
  OpenStreetMap,
  flextable,
  rio, 
  gtsummary, 
  epikit
)


conflicted::conflicts_prefer(dplyr::filter)
conflicted::conflicts_prefer(flextable::align)

 
```


# loading data

```{r echo=FALSE}

# importing the data 
cholera_data<- import( here("data/cholera_data_.csv")) %>%
                clean_names() %>% 
  mutate(district=recode(
      district, 
      "Blantyre_City"="Blantyre"
    ))%>% 
   mutate(residence = case_when(
district %in% c("Lilongwe", "Blantyre", "Dedza", "Bakala") ~ "In land",
    TRUE ~ "lake shore" )) 

# changing the data.frame into tibble object for easy handling 
cholera_data<- tibble(cholera_data)


# filtering out those less than 18 years 
cholera_data<-cholera_data %>% 
  filter(age_group!="<18")

ta_shapefile<-st_read(
  here("data/MWI_adm1.shp")
) %>% 
  select(
   NAME_1,
    ID_0,
    ID_1) %>% 
  dplyr::rename(
    "District"= NAME_1
  )


```

# Social and behavioral factors that influence current water treatment practices

### Awareness of the Health Risk Associated with drinking untreated Water by Sex, Age-Group, Level of Education,  and District 

```{r echo=FALSE}

awareness_of_heathRisk<-cholera_data %>% 
                 select(
                   sex, 
                   age_group, 
                   level_education, 
                   district,
                   residence
                  ,
           health_risk_associated_with_drinking_untreated_water
                 )


awareness_of_heathRisk %>% 
          # select(-district , -zone) %>%
  tbl_summary(health_risk_associated_with_drinking_untreated_water,
            percent = "row",
            digits = list(
              sex ~ c(0, 1),
              age_group ~ c(0, 1),
              level_education ~ c(0, 1), 
              district ~ c(0, 1),
              residence ~ c(0, 1)
            ))

```


### 2.3. 0 Main sources of drinking water during the dry season by District/ Township 

```{r echo=FALSE}
drinking_dry<-cholera_data %>% 
  select(district, 
         residence, 
         main_source_of_drinking_water_dry_season)


drinking_dry<- drinking_dry %>% 
  group_by( district, 
            main_source_of_drinking_water_dry_season) %>%
  count(main_source_of_drinking_water_dry_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_dry_season, 
    values_from = n
  )

# replacing NA with Zero 
drinking_dry[is.na(drinking_dry)]<-0


main_source_table<- drinking_dry %>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         percentage=round(community_standpipe/total*100, 2),
          community_standpipe=paste0(community_standpipe,
                                   " (", round(percentage, 1), "%)"),
        percentage=round(borehole_1/total*100, 2 ),
        borehole_1=paste0(borehole_1, " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_dwelling/total*100, 2),
                 piped_into_dwelling=paste0(piped_into_dwelling,
                                   " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_yard_plot/total*100, 2),
                 piped_into_yard_plot=paste0(piped_into_yard_plot,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(protected_well_1/total*100, 2), 
           protected_well_1=paste0(protected_well_1,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(unprotected_well_1/total*100, 2),
           unprotected_well_1=paste0(unprotected_well_1,
                                   " (", round(percentage, 1), "%)"),
                   percentage=round(other_drinking_source/total*100, 2),
              other_drinking_source=paste0(other_drinking_source,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(river_stream/total*100, 2), 
              river_stream=paste0(river_stream,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(spring_1/total*100, 2), 
       spring_1=paste0(spring_1, " (", round(percentage, 1), "%)"),
         percentage=round(dam/total/100, 2), 
      dam=paste0(dam, " (", round(percentage, 1), "%)"),
         percentage=round(bottled_water/total*100, 2), 
   bottled_water=paste0(bottled_water, " (", round(percentage, 1), "%)"),
         percentage=round(tanker_truck_bower/total*100, 2), 
tanker_truck_bower=paste0(tanker_truck_bower,
                          " (", round(percentage, 1), "%)"),
         percentage=round(lake/total*100, 2),
    lake=paste0(lake, " (", round(percentage, 1), "%)")
         )

main_source_table %>% 
  rename_with(~ str_replace_all(., "_", " ")) %>% 
    rename_with(~ str_replace_all(., "1", "")) %>% 
  select(-total, -percentage) %>%
    as_flextable() %>% 
 flextable::rotate(j = c(2:14), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)



drinking_dry_redience<-cholera_data %>% 
  select(residence, 
         main_source_of_drinking_water_dry_season)

drinking_dry_redience<- drinking_dry_redience%>% 
  group_by( residence,
           main_source_of_drinking_water_dry_season) %>%
  count(main_source_of_drinking_water_dry_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_dry_season, 
    values_from = n
  )


# replacing NA with Zero 
drinking_dry_redience[is.na(drinking_dry_redience)]<-0



    table5<- drinking_dry_redience %>% 
      rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
      percentage=round(community_standpipe/total*100, 2),
          community_standpipe=paste0(community_standpipe,
                                   " (", round(percentage, 1), "%)"),
        percentage=round(borehole_1/total*100, 2 ),
        borehole_1=paste0(borehole_1, " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_dwelling/total*100, 2),
                 piped_into_dwelling=paste0(piped_into_dwelling,
                                   " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_yard_plot/total*100, 2),
                 piped_into_yard_plot=paste0(piped_into_yard_plot,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(protected_well_1/total*100, 2), 
           protected_well_1=paste0(protected_well_1,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(unprotected_well_1/total*100, 2),
           unprotected_well_1=paste0(unprotected_well_1,
                                   " (", round(percentage, 1), "%)"),
                   percentage=round(other_drinking_source/total*100, 2),
              other_drinking_source=paste0(other_drinking_source,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(river_stream/total*100, 2), 
              river_stream=paste0(river_stream,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(spring_1/total*100, 2), 
       spring_1=paste0(spring_1, " (", round(percentage, 1), "%)"),
         percentage=round(dam/total/100, 2), 
      dam=paste0(dam, " (", round(percentage, 1), "%)"),
         percentage=round(bottled_water/total*100, 2), 
   bottled_water=paste0(bottled_water, " (", round(percentage, 1), "%)"),
         percentage=round(tanker_truck_bower/total*100, 2), 
tanker_truck_bower=paste0(tanker_truck_bower,
                          " (", round(percentage, 1), "%)"),
         percentage=round(lake/total*100, 2),
    lake=paste0(lake, " (", round(percentage, 1), "%)")
         )
         
         
table5 %>% 
  rename_with(~ str_replace_all(., "_", " ")) %>% 
    rename_with(~ str_replace_all(., "1", "")) %>% 
  select(-total, -percentage) %>%
    as_flextable() %>% 
 flextable::rotate(j = c(2:14), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)
    



```


## 2.4. 0 Main sources of drinking water during the wet season by District

```{r echo=FALSE}

wet_drink_district <- cholera_data %>% 
                      select(district, 
                             main_source_of_drinking_water_wet_season)


wet_drink_district<- wet_drink_district %>% 
  group_by( district, 
           main_source_of_drinking_water_wet_season) %>%
  count(main_source_of_drinking_water_wet_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_wet_season, 
    values_from = n
  )




# replacing NA with Zero 
wet_drink_district[is.na(wet_drink_district)]<-0


table6<- wet_drink_district %>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
          percentage=round(community_standpipe/total*100, 2),
          community_standpipe=paste0(community_standpipe,
                                   " (", round(percentage, 1), "%)"),
        percentage=round(borehole_1/total*100, 2 ),
        borehole_1=paste0(borehole_1, " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_dwelling/total*100, 2),
                 piped_into_dwelling=paste0(piped_into_dwelling,
                                   " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_yard_plot/total*100, 2),
                 piped_into_yard_plot=paste0(piped_into_yard_plot,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(protected_well_1/total*100, 2), 
           protected_well_1=paste0(protected_well_1,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(unprotected_well_1/total*100, 2),
           unprotected_well_1=paste0(unprotected_well_1,
                                   " (", round(percentage, 1), "%)"),
                   percentage=round(other_drinking_source/total*100, 2),
              other_drinking_source=paste0(other_drinking_source,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(river_stream/total*100, 2), 
              river_stream=paste0(river_stream,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(spring_1/total*100, 2), 
       spring_1=paste0(spring_1, " (", round(percentage, 1), "%)"),
         percentage=round(dam/total/100, 2), 
      dam=paste0(dam, " (", round(percentage, 1), "%)"),
         percentage=round(bottled_water/total*100, 2), 
   bottled_water=paste0(bottled_water, " (", round(percentage, 1), "%)"),
         percentage=round(tanker_truck_bower/total*100, 2), 
tanker_truck_bower=paste0(tanker_truck_bower,
                          " (", round(percentage, 1), "%)"),
         percentage=round(lake/total*100, 2),
    lake=paste0(lake, " (", round(percentage, 1), "%)")
         )
         


 table6 %>% 
rename_with(~ str_replace_all(., "_", " ")) %>% 
    rename_with(~ str_replace_all(., "1", "")) %>% 
  select(-total, -percentage) %>%
    as_flextable() %>% 
 flextable::rotate(j = c(2:15), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)






# by Zone 


wet_drink_zone <- cholera_data %>% 
                      select(residence, 
                             main_source_of_drinking_water_wet_season)


wet_drink_zone<- wet_drink_zone %>% 
  group_by( residence,, 
           main_source_of_drinking_water_wet_season) %>%
  count(main_source_of_drinking_water_wet_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_wet_season, 
    values_from = n
  )




# replacing NA with Zero 
wet_drink_zone[is.na(wet_drink_zone)]<-0


table7<- wet_drink_zone%>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
             percentage=round(community_standpipe/total*100, 2),
          community_standpipe=paste0(community_standpipe,
                                   " (", round(percentage, 1), "%)"),
        percentage=round(borehole_1/total*100, 2 ),
        borehole_1=paste0(borehole_1, " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_dwelling/total*100, 2),
                 piped_into_dwelling=paste0(piped_into_dwelling,
                                   " (", round(percentage, 1), "%)"),
             percentage= round(piped_into_yard_plot/total*100, 2),
                 piped_into_yard_plot=paste0(piped_into_yard_plot,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(protected_well_1/total*100, 2), 
           protected_well_1=paste0(protected_well_1,
                                   " (", round(percentage, 1), "%)"),
                 percentage=round(unprotected_well_1/total*100, 2),
           unprotected_well_1=paste0(unprotected_well_1,
                                   " (", round(percentage, 1), "%)"),
                   percentage=round(other_drinking_source/total*100, 2),
              other_drinking_source=paste0(other_drinking_source,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(river_stream/total*100, 2), 
              river_stream=paste0(river_stream,
                                   " (", round(percentage, 1), "%)"),
         percentage=round(spring_1/total*100, 2), 
       spring_1=paste0(spring_1, " (", round(percentage, 1), "%)"),
         percentage=round(dam/total/100, 2), 
      dam=paste0(dam, " (", round(percentage, 1), "%)"),
         percentage=round(bottled_water/total*100, 2), 
   bottled_water=paste0(bottled_water, " (", round(percentage, 1), "%)"),
         percentage=round(tanker_truck_bower/total*100, 2), 
tanker_truck_bower=paste0(tanker_truck_bower,
                          " (", round(percentage, 1), "%)"),
         percentage=round(lake/total*100, 2),
    lake=paste0(lake, " (", round(percentage, 1), "%)")
         )
         


table7 %>% 
     rename_with(~ str_replace_all(., "_", " ")) %>% 
    rename_with(~ str_replace_all(., "1", "")) %>% 
  select(-total, -percentage) %>%
    as_flextable() %>% 
 flextable::rotate(j = c(2:15), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)
   


```

### 2.5.1 Water Treatment at Household by Sex, Level of Education, Religion

```{r echo=FALSE}

Water_treat<-cholera_data %>% 
         select(sex, 
                age_group, 
                level_education, 
                religion, 
                treat_drinking_water)


table8<- Water_treat %>% 
  tbl_summary(treat_drinking_water, 
              percent = "row", 
              digits = list(
                sex~ c(0, 2), 
                age_group~c(0,2), 
                level_education~ c(0,2), 
                religion~c(0,2)
              ))

table8


```


### 2.5.2 Water Treatment at Household by District 

```{r echo=FALSE}
 


Water_treat_district_zone<-cholera_data %>%
         select(district,
                residence,
                treat_drinking_water)


table9<- Water_treat_district_zone%>%
  tbl_summary(treat_drinking_water,
              percent = "row",
              digits = list(
                district~ c(0, 2),
                residence~c(0,2)

              ))

table9

```


### yes, Methods of water treatment by District

```{r echo=FALSE, fig.height=7, fig.width=14}

methods_water <- cholera_data %>%
               select(
                  sex,
                  age_group,
                  level_education,
                  religion,
                 c(34:41)
               )


age_group_table<-methods_water %>%
  select(
    age_group,
    where(is.numeric)
  ) %>% 
  pivot_longer(
    cols = (2:9)
  ) %>%
  drop_na(value) %>%
  group_by(
     age_group,
      name) %>%
  summarise(value=sum(value)) %>%
  pivot_wider(
    names_from = name,
  values_from = value,
  ) %>%
  group_by(
    age_group
  ) %>%
  rowwise() %>%
  mutate(total=sum(across(where(is.numeric)))) %>% 
   rename("variable"=age_group)


  sex_table<-methods_water %>%
  select(
    sex,
    where(is.numeric)
  ) %>% 
  pivot_longer(
    cols = (2:9)
  ) %>%
  drop_na(value) %>%
  group_by(
     sex,
      name) %>%
  summarise(value=sum(value)) %>%
  pivot_wider(
    names_from = name,
  values_from = value,
  ) %>%
  group_by(
    sex
  ) %>%
  rowwise() %>%
  mutate(total=sum(across(where(is.numeric)))) %>% 
   rename("variable"=sex)
    

    
education_table<- methods_water %>%
  select(
    level_education,
    where(is.numeric)
  ) %>% 
  pivot_longer(
    cols = (2:9)
  ) %>%
  drop_na(value) %>%
  group_by(
     level_education,
      name) %>%
  summarise(value=sum(value)) %>%
  pivot_wider(
    names_from = name,
  values_from = value,
  ) %>%
  group_by(
    level_education,
  ) %>%
  rowwise() %>%
  mutate(total=sum(across(where(is.numeric)))) %>% 
   rename("variable"=level_education)
 
    
    
    
religion_table<-methods_water %>%
  select(
    religion,
    where(is.numeric)
  ) %>% 
  pivot_longer(
    cols = (2:9)
  ) %>%
  drop_na(value) %>%
  group_by(
     religion,
      name) %>%
  summarise(value=sum(value)) %>%
  pivot_wider(
    names_from = name,
  values_from = value,
  ) %>%
  group_by(
    religion,
  ) %>%
  rowwise() %>%
  mutate(total=sum(across(where(is.numeric)))) %>% 
   rename("variable"=religion)

    
    # Combine all tables into one
    table10 <- bind_rows(sex_table,
                         age_group_table,
                         education_table,
                         religion_table)
# 
# 

 table10<- table10 %>%
  mutate(
 percentage= round(method_of_water_treatment_boiling/total*100, 2) ,
 
 method_of_water_treatment_boiling= paste0(method_of_water_treatment_boiling,
          " (", round(percentage, 1), "%)"),
 
 percentage= round(method_of_water_treatment_ceramic_filter/total*100, 2),
 
 method_of_water_treatment_ceramic_filter= paste0(method_of_water_treatment_ceramic_filter,
          " (", round(percentage, 1), "%)"), 
 
 
 percentage= round(method_of_water_treatment_filter_with_cloth/total*100, 2),
 
 
 method_of_water_treatment_filter_with_cloth= paste0(method_of_water_treatment_filter_with_cloth,
          " (", round(percentage, 1), "%)"),
 
percentage=round(method_of_water_treatment_others_methods/total*100, 2),
 
 
 method_of_water_treatment_others_methods= paste0(method_of_water_treatment_others_methods,
          " (", round(percentage, 1), "%)"),
 
 
 percentage=round(method_of_water_treatment_solar_disinfection/total*100, 2),


 method_of_water_treatment_solar_disinfection= paste0(method_of_water_treatment_solar_disinfection,
          " (", round(percentage, 1), "%)"),


percentage=round(method_of_water_treatment_stand_settle/total*100, 2),

 method_of_water_treatment_stand_settle= paste0(method_of_water_treatment_stand_settle,
          " (", round(percentage, 1), "%)"),

 percentage= round(method_of_water_treatment_use_chlorine/total*100, 2),

 method_of_water_treatment_use_chlorine= paste0(method_of_water_treatment_use_chlorine,
          " (", round(percentage, 1), "%)"),


 percentage=round(method_of_water_treatment_use_water_from_tap/total*100, 2),

 method_of_water_treatment_use_water_from_tap= paste0(method_of_water_treatment_use_water_from_tap,
          " (", round(percentage, 1), "%)")

    )
 
 
 
 table10 %>% 
   select(-total, -percentage) %>% 
   rename_with(~ str_replace_all(., 
       "method_of_water_treatment_", " ")) %>% 
    rename_with(~ str_replace_all(., "_", " ")) %>% 
    as_flextable() %>% 
 flextable::rotate(j = c(2:9), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)

 
```


```{r include=FALSE}

methods_water_district <- cholera_data %>% 
               select(
                 district, 
                 residence,
                 c(34:41)
               )



tabel11_district<- methods_water_district %>% 
  select(
    district,
    where(is.numeric)
  ) %>%
  pivot_longer(
    cols = (2:9)
  ) %>% 
  drop_na(value) %>% 
  group_by(
    district, 
    name) %>% 
  summarise(value=sum(value)) %>% 
  pivot_wider(
    names_from = name, 
  values_from = value, 
  ) %>% 
  group_by(
    district
  ) %>% 
  rowwise() %>% 
  mutate(total=sum(across(where(is.numeric)))) %>% 
  rename("variable"=district)


table11_residence<- methods_water_district%>% 
  select(
    residence,
    where(is.numeric)
  ) %>%
  pivot_longer(
    cols = (2:9)
  ) %>% 
  drop_na(value) %>% 
  group_by(
    residence, 
    name) %>% 
  summarise(value=sum(value)) %>% 
  pivot_wider(
    names_from = name, 
  values_from = value, 
  ) %>% 
  group_by(
    residence
  ) %>% 
  rowwise() %>% 
  mutate(total=sum(across(where(is.numeric)))) %>% 
  rename("variable"=residence)


tabel11<- bind_rows(tabel11_district,
                     table11_residence)

tabel11<- tabel11 %>% 
mutate(
 percentage= round(method_of_water_treatment_boiling/total*100, 2) ,
 
 method_of_water_treatment_boiling= paste0(method_of_water_treatment_boiling,
          " (", round(percentage, 1), "%)"),
 
 percentage= round(method_of_water_treatment_ceramic_filter/total*100, 2),
 
 method_of_water_treatment_ceramic_filter= paste0(method_of_water_treatment_ceramic_filter,
          " (", round(percentage, 1), "%)"), 
 
 
 percentage= round(method_of_water_treatment_filter_with_cloth/total*100, 2),
 
 
 method_of_water_treatment_filter_with_cloth= paste0(method_of_water_treatment_filter_with_cloth,
          " (", round(percentage, 1), "%)"),
 
percentage=round(method_of_water_treatment_others_methods/total*100, 2),
 
 
 method_of_water_treatment_others_methods= paste0(method_of_water_treatment_others_methods,
          " (", round(percentage, 1), "%)"),
 
 
 percentage=round(method_of_water_treatment_solar_disinfection/total*100, 2),


 method_of_water_treatment_solar_disinfection= paste0(method_of_water_treatment_solar_disinfection,
          " (", round(percentage, 1), "%)"),


percentage=round(method_of_water_treatment_stand_settle/total*100, 2),

 method_of_water_treatment_stand_settle= paste0(method_of_water_treatment_stand_settle,
          " (", round(percentage, 1), "%)"),

 percentage= round(method_of_water_treatment_use_chlorine/total*100, 2),

 method_of_water_treatment_use_chlorine= paste0(method_of_water_treatment_use_chlorine,
          " (", round(percentage, 1), "%)"),


 percentage=round(method_of_water_treatment_use_water_from_tap/total*100, 2),

 method_of_water_treatment_use_water_from_tap= paste0(method_of_water_treatment_use_water_from_tap,
          " (", round(percentage, 1), "%)")

    ) %>% 
  select(-total, -percentage)



tabel11<- tabel11 %>%
  rename_with(~ str_replace_all(., "method_of_water_treatment_", " "))

tabel11<- tabel11 %>%
  rename_with(~ str_replace_all(., "_", " "))

tabel11 %>% 
as_flextable() %>% 
 flextable::rotate(j = c(2:9), part = "header",
         rotation = "btlr") %>%  # Rotate header text 90°
flextable:: align(align = "center", part = "header") %>% 
  autofit() %>%  # Fit column content first
 flextable:: width(j = NULL, width = 1.2)


```



##2.5.4 Properly chlorination process by district.

```{r echo=TRUE}
properly_chro_district <- cholera_data %>% 
            select(district, 
                   chlorination_process_done_correctly)


table12<- properly_chro_district %>% 
  tbl_summary(chlorination_process_done_correctly, 
              percent = "row", 
              digits = list(
                district~c(0,2)
              ))


table12<- table12 %>% 
  as_flex_table()


save_as_docx(table12, path = here("output/table12.docx"))




## by Sex, Age and Education 


properly_chro_demo<- cholera_data %>% 
            select(sex,
                   age_group, 
                   level_education, 
                   religion,
                   chlorination_process_done_correctly)


table13<- properly_chro_demo %>% 
  tbl_summary(chlorination_process_done_correctly, 
              percent = "row", 
              digits = list(
              sex~c(0,2), 
                 age_group~c(0,2), 
                 level_education~c(0,2), 
                 religion~c(0,2)
              ))


table13<- table13 %>% 
  as_flex_table()


save_as_docx(table13, path = here("output/table13.docx"))


```

## 2.5. 5 Frequency of water treatment by Sex, Level of Education, Religion 

```{r include=FALSE}
freq_water_treatment <- cholera_data %>% 
                        select(
                          sex, 
                          age_group, 
                          level_education, 
                          religion, 
                          often_treat_water
                        )



table14<- freq_water_treatment %>% 
  tbl_summary(often_treat_water, 
              digits = list(
                sex~c(0,2), 
                age_group~c(0,2), 
                level_education~c(0,2), 
                religion~c(0,2)
              ))


table14<- table14 %>% 
  as_flex_table()


save_as_docx(table14, path = here("output/table14.docx"))



freq_water_treatment_district <- cholera_data %>% 
                                select(
                                  district,
                                  zone,
                                  often_treat_water
                                )


freq_water_treatment_district %>% 
          tbl_summary(often_treat_water, 
                      digits = list(
                        district~c(0,2), 
                        zone~c
                      ))



```

## 2. 5.6 Access to water treatment by district 

```{r include=FALSE}




```

## 2. 6.0 Knowledge of cholera calendar year.  By Sex, Level of Education, Religion 

```{r}




```


## 2. 7. 0 Knowledge of the potential Cause of Cholera.

```{r}





 
```

## 2.8. 0 Knowledge of the Prevention Measures of cholera by Sex, Level of Education and Religious Belief.  


```{r}





```

## 2.8. 0 Knowledge of the Prevention Measures of cholera by District 
```{r}





```


## 2. 9.0 Current local measures or campaigns in place to prevent cholera outbreaks by Districts
```{r}




```

# Social and cultural behavior determinants of vaccine uptake 


## 3.1. 0 Aware of Cholera Vaccine by  Age- Group, Sex Level of Education, and 3.1. 1 Aware of Cholera Vaccine by  District and Zone  



```{r}


 
```

## 3.2.0  Believe Cholera Vaccine Prevent Cholera by Sex, Level of Education 

```{r}



```

## 3.2.1  Believe Cholera Vaccine Prevent District and Zone 

```{r}



```

##3.3. 0 Information about Cholera Vaccine  by Sex, Age Group,  Education, Religion 

```{r}





```



## 3.3. 1 Information about Cholera Vaccine  by  District and Zone 

```{r}



```



## 3. 4. 0 Safe of Cholera Vaccine by Sex Age Group Education and Religion 

```{r}



```


##3. 4. 1 Safe of Cholera Vaccine by District and Zone 

```{r}



```

## 3. 5. 0 Community Influence decision about vaccination by District and Zone 

```{r}

              


```



## 3. 6. 0 Difficult in access cholera vaccination by Sex, Education and Religion  

```{r}







```


## 3. 6. 1 Difficult in access cholera vaccination by District 


```{r}





```



##3. 7. 0 OCV status by Sex, Age Group, Education and Religious 

```{r}

```



## 3. 7. 0 OCV status by District and Zone  

```{r}

```


## 3. 8. 0 Family Members vaccinated by District and Zone 
```{r}

```


## 3. 9. 0 Willingness to get vaccinated in the Future OCV by Sex, Age Group and Education 

```{r}

```


## 3. 9. 1 Willingness to get vaccinated in the Future OCV by District and Zone 

```{r}

```


## 3. 10. 0 Recommend a Family member to get vaccinated by District and Zone 

```{r}

```



## 3. 13. 0 Prefer ways to Receive Information about Vaccine by Sex, Age Group and Education and Religious 
```{r}

```



## 3. 13. 1 Prefer ways to Receive Information about Vaccine by District and Zone 

```{r}

```





# 4. 0 . Availability and use of sanitary services and infrastructure for cholera prevention



# Percentage of households that have toilets

## 1.	Do you have toilet?

```{r}

knitr::opts_chunk$set(tidy = TRUE, collapse = TRUE, rows.print = 12)

available_toilet<- cholera_data %>% 
            select(district, 
                   residence, 
                   toilet_facility_avaiable)

              
toilet_dis_table<- available_toilet %>% 
  group_by(district) %>%
  count(toilet_facility_avaiable) %>% 
  drop_na(toilet_facility_avaiable) %>% 
  pivot_wider(names_from = toilet_facility_avaiable,
              values_from = n) %>% 
  # adorn_totals("row") %>%
  mutate(total=available+not_available, 
         available= round( available/total*100,2), 
         not_available=round( not_available/total*100,2)) %>% 
  rename("Background_charateristic" = district)



toilet_res_table<- available_toilet %>% 
  group_by(residence) %>%
  count(toilet_facility_avaiable) %>% 
  drop_na(toilet_facility_avaiable) %>% 
  pivot_wider(names_from = toilet_facility_avaiable,
              values_from = n) %>% 
  adorn_totals("row") %>%
  mutate(total=available+not_available, 
         available= round( available/total*100,2), 
         not_available=round( not_available/total*100,2)) %>% 
  rename("Background_charateristic" = residence)



table20<-rbind(toilet_dis_table, toilet_res_table) 

empty_row1 <- data.frame(Background_charateristic= "District",
                        available = NA,
                        not_available = NA, 
                        total = NA)
  
empty_row2 <- data.frame(Background_charateristic= "Residence",
                        available = NA,
                        not_available = NA, 
                        total = NA)


table20<- rbind(empty_row1, table20[1:7, ],
      empty_row2, table20[8:nrow(table20), ])

table20<- table20 %>%
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )


save_as_docx(table20, path= here("output/table20.docx"))
  



```



## District from the toilets


```{r}

available_toilet_demo<- cholera_data %>% 
            select(sex, 
                   level_education,
                   ethnicity,
                   toilet_facility_avaiable)


sex_table<- create_summary_table(available_toilet_demo, "sex", 
                     "toilet_facility_avaiable")
leduction_table<- create_summary_table(available_toilet_demo, "level_education",
                     "toilet_facility_avaiable")
ethincity_table<- create_summary_table(available_toilet_demo,
                                       "ethnicity",
                     "toilet_facility_avaiable", 
                      sum = T)

toilet_table_demo<-rbind(sex_table, leduction_table, ethincity_table)


toilet_table<-toilet_table_demo %>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )

save_as_docx(toilet_table, path = here("output/toilet_table.docx"))


```



## 2.	What type of toilet facility do members of your     household usually use? 


```{r}





```




## 3.	Do you have Refuse pit?


```{r}

refuse_pit<- cholera_data %>% 
            select(district, 
                   residence, 
                   soild_waste_disposal,
                   bath_shelter_bathroom)


refuse_pit_dis_table<- refuse_pit %>%
             create_summary_table("district", "soild_waste_disposal")

refuse_pit_res_table <- refuse_pit %>% 
         create_summary_table("residence",
                              "soild_waste_disposal",
                              sum = T)


refuse_pit_table<-rbind(refuse_pit_dis_table,
                        refuse_pit_res_table)


bath_shelter_dis_table<- refuse_pit %>%
             create_summary_table("district", "bath_shelter_bathroom")

bath_shelter_res_table <- refuse_pit %>%
    create_summary_table("residence",
                              "bath_shelter_bathroom",
                              sum = T)


bath_shelter_table<-rbind(bath_shelter_dis_table,
                          bath_shelter_res_table)

bath_shelter_table <- bath_shelter_table %>% 
  rename("Bath_available"=available_percent, 
         "Bath_not_available"=not_available_percent)



refuse_pit_table <- refuse_pit_table %>%
  rename("Refuse_pit_available"=available_percent, 
         "Refuse_pit_not_available"=not_available_percent)

merge(refuse_pit_table, bath_shelter_table,
      by.x = "Background_charateristic")
  # flextable() %>%
  # autofit()
  # set_table_properties(layout = "autofit") %>%
  # height_all(height =  0.5, unit = "in" ) %>%
  # save_as_docx(path = here("output/refuse_pit_table.docx"))


refuse_pit_table1<-merge.data.frame(refuse_pit_table,
                                    bath_shelter_table) %>% 
   select(Background_characteristic,
         Refuse_pit_available, Refuse_pit_not_available,
         Bath_available, Bath_not_available, total)

Refuse_pit_table1<- refuse_pit_table1 %>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )


save_as_docx(Refuse_pit_table1, path = here("output/Refuse_pit_table1.docx"))
  
  
```

## 4.	Do you have Bath Shelter with good drainage?


```{r}

```



## 5.	the pit latrine Condtion by District?




```{r}

Pit_condition <- cholera_data %>% 
                   select(district,
                          residence, 
                          pit_condition)


stack_bar_pit_conition<- Pit_condition %>% 
  group_by(district, pit_condition) %>%
  summarise(n=n()) %>% 
  drop_na(pit_condition) %>%
  pivot_wider(names_from = pit_condition,
              values_from = n) %>% 
  mutate(total=not_pit+overflowing+properly_maintained, 
         not_pit= round(not_pit/total*100, 2), 
         overflowing=round(overflowing/total*100, 2), 
       properly_maintained=round(properly_maintained/total*100, 2)) %>% 
  select(district, not_pit, overflowing, properly_maintained) %>% 
  pivot_longer(cols = c(not_pit, overflowing, properly_maintained),
               names_to = "Pit_condition",
               values_to = "Percentage") %>% 
   mutate(Pit_condition = factor(Pit_condition, 
                                 levels = c("properly_maintained",
                                            "overflowing",
                                            "not_pit"))) %>% 
  ggplot(aes(x=district, y=Percentage, fill=Pit_condition))+
  geom_col()+
  coord_flip()+
  scale_fill_manual(values = c( "properly_maintained" = "green",
                                "overflowing" = "yellow",
                                "not_pit" = "red" )) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = "black"), 
        axis.text.y = element_text(size = 12, colour = "black"), 
        axis.title.y = element_text(size = 14, colour = "black"), 
        axis.title.x = element_text(size = 14, colour = "black"))+
  labs(y = "Percentage") +
  ggtitle("Pit Condition by District")+
  geom_text(aes(label = paste0(Percentage,"%")), 
            position = position_stack(vjust = 0.5))


ggsave("output/stack_bar_pit_conition.png", 
       plot = stack_bar_pit_conition,
       width = 10, height = 10, units = "in", dpi = 300, 
       bg="white")





```


## 6.	Pit condition by residence 


```{r}

 stack_bar_residence<- Pit_condition %>% 
  mutate(residence = recode(residence,
                        "in_land"="in land", 
                        "lake_share" = "Lake Shore")) %>%
  group_by(residence, pit_condition) %>%
  summarise(n=n()) %>% 
  drop_na(pit_condition) %>%
  pivot_wider(names_from = pit_condition,
              values_from = n) %>% 
  mutate(total=not_pit+overflowing+properly_maintained, 
         not_pit= round(not_pit/total*100, 2), 
         overflowing=round(overflowing/total*100, 2), 
       properly_maintained=round(properly_maintained/total*100, 2)) %>% 
  select(residence, not_pit, overflowing, properly_maintained) %>% 
  pivot_longer(cols = c(not_pit, overflowing, properly_maintained),
               names_to = "Pit_condition",
               values_to = "Percentage") %>% 
   mutate(Pit_condition = factor(Pit_condition, 
                                 levels = c("properly_maintained",
                                            "overflowing",
                                            "not_pit"))) %>% 
  ggplot(aes(x=residence, y=Percentage, fill=Pit_condition))+
  geom_col()+
  coord_flip()+
  scale_fill_manual(values = c( "properly_maintained" = "green",
                                "overflowing" = "yellow",
                                "not_pit" = "red" )) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = "black"), 
        axis.text.y = element_text(size = 12, colour = "black"), 
        axis.title.y = element_text(size = 14, colour = "black"), 
        axis.title.x = element_text(size = 14, colour = "black"))+
  labs(y = "Percentage", 
       x="Residence") +
  ggtitle("Pit Condition by Residence")+
  geom_text(aes(label = paste0(Percentage,"%")), 
            position = position_stack(vjust = 0.5))


ggsave("output/stack_bar_residenc.png", 
       plot = stack_bar_residence,
       width = 10, height = 10, units = "in", dpi = 300, 
       bg="white")







```


```{r}




```





## 7.	How often do you wash hands with soap after using the toilet or handling food?


```{r}

Pit_condition %>% 
  group_by(district, pit_condition) %>%
  summarise(n=n()) %>% 
  drop_na(pit_condition) %>%
  pivot_wider(names_from = pit_condition,
              values_from = n) %>% 
  mutate(total=not_pit+overflowing+properly_maintained, 
         not_pit= round(not_pit/total*100, 2), 
         overflowing=round(overflowing/total*100, 2), 
         properly_maintained=round(properly_maintained/total*100, 2)) %>% 
  select(district, not_pit, overflowing, properly_maintained) %>% 
  pivot_longer(cols = c(not_pit, overflowing, properly_maintained),
               names_to = "Pit_condition",
               values_to = "Percentage") %>% 

ggplot(aes(x = district, y = Percentage, color = Pit_condition)) +
  geom_point(size = 5) +
  geom_line(aes(group = district), size = 1) +
  coord_flip() +
  theme_minimal() +
  scale_color_manual(values = c("not_pit" = "red",
                                "overflowing" = "yellow",
                                "properly_maintained" = "green")) +
  labs(y = "Percentage", title = "Pit Condition by District")




```

## 8.	Hand washing facility by district and residence


```{r}

Household_handwashing<- cholera_data %>% 
            select(district, 
                   residence, 
                   household_handwashing_facility)

grouding_vars<- c("district", "residence")


 Household_handwashing_tab<- Household_handwashing %>% 
  create_summary_table3(grouding_vars, "household_handwashing_facility",                         sum = T)



Household_handwashing_tab<- Household_handwashing_tab%>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )


save_as_docx(Household_handwashing_tab, path = here("output/Household_handwashing_tab.docx"))


table(cholera_data$san_facility_unavailable)





```


## 9.	if san facilities is not available. how people manage by district

```{r}

san_facility_unavailable<- cholera_data %>% 
            select(district, 
                   residence, 
                   san_facility_unavailable)


grouping_vars<- c("district", "residence")


san_table<- san_facility_unavailable %>% 
  create_summary_table3(grouping_vars, 
                        "san_facility_unavailable", sum = T)

san_table<-san_table%>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )


save_as_docx(san_table, path = here("output/san_table.docx"))


```




```{r}

san_facility_unavailable_demo<- cholera_data %>% 
            select(sex,
                   age_group, 
                   level_education, 
                   ethnicity,
                   san_facility_unavailable)

grouding_vars <- c("sex", "age_group", "level_education", "ethnicity")



san_demo_table<- san_facility_unavailable_demo %>% 
  create_summary_table3(grouding_vars,
                        "san_facility_unavailable",
                        sum = T)


san_demo_table<-san_demo_table%>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )

save_as_docx(san_demo_table, 
             path = here("output/san_demo_table.docx"))


```





## 10.	What are the common reasons for not using available sanitary facilities? 


```{r}

common_reason<- cholera_data %>% 
            select(district, 
                   residence, 
    common_reasons_not_using_san_facilities_poor_maintenance_unhygienic, common_reasons_not_using_san_facilities_cost,
    common_reasons_not_using_san_facilities_distance)



common_reason <- common_reason %>%
   rename_with(~ str_replace_all(.,
                    "common_reasons_not_using_san_facilities_",
                    ""))

common_reason<- common_reason %>% 
  pivot_longer(cols = c(poor_maintenance_unhygienic, cost, distance),
               names_to = "Reason",
               values_to = "Percentage") %>% 
  filter(Percentage == 1) %>%
  select(district, residence, Reason)


grouding_vars<- c("district", "residence")



common_reason<- common_reason %>% 
create_summary_table3(grouding_vars, "Reason",
                      sum = T)

common_reason_table<-common_reason%>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" ) 


save_as_docx(common_reason_table,
             path = here("output/common_reason_table.docx"))


```










