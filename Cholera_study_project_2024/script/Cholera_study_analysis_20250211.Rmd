---
title: "old code"
author: "Selemani Ngwira"
date: "2024-12-16"
output:
  word_document: default
  html_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


if(!require(pacman)) install.packages("pacman")

p_load(
  tidyverse,
  here,
  summarytools,
  janitor,
  sf, 
  terra,
  tmap,
  OpenStreetMap,
  flextable,
  rio, 
  gtsummary, 
  epikit, 
  pwr, 
  webshot2,
  gtsummary, 
   BiocManager,
  ggradar,
  scales,
  fmsb,
  officer)
 

conflicted::conflict_prefer("select", "dplyr")

options("max.print" = 10000)  # Increase the print limit



install.packages("devtools")

devtools::install_github("ricardo-bion/ggradar")

devtools::install_github("slidexyz/ggradar2")


```

# loading data


```{r cars}

# importing the data 
cholera_data<-import(here("/Users/alex/Documents/GitHub/R_Projects/Cholera_study_project_2024/data/cholera_data_.csv")) %>%
                clean_names() %>% 
  mutate(district=recode(
      district, 
      "Blantyre_City"="Blantyre"
    )) %>% 
   mutate(residence = case_when(
    district %in% c("Lilongwe", "Blantyre", "Dedza", "Bakala") ~ "in_land",
    TRUE ~ "lake_share" ))

# changing the data.frame into tibble object for easy handling 
cholera_data<- tibble(cholera_data)



# filtering out those less than 18 years 
cholera_data<-cholera_data %>% 
  dplyr::filter(age_group!="<18")


ta_shapefile<-sf:: st_read(
  here("data/MWI_adm1.shp")
) %>% 
  select(
   NAME_1,
    ID_0,
    ID_1) %>% 
  dplyr::rename(
    "District"= NAME_1
  )




```

# Social and behavioral factors that influence current water treatment practices

## Source of Water for Daily use by District   


```{r pressure, echo=FALSE}







```


## Awareness of the Health Risk Associated with drinking untreated Water by Sex, Age-Group, Level of Education,  and District 

```{r}

awareness_of_heathRisk<-cholera_data %>% 
                 select(
                   sex, 
                   age_group, 
                   level_education, 
                   district,
                   residence,
                   zone,
                   health_risk_associated_with_drinking_untreated_water
                 )


table2<-awareness_of_heathRisk %>% 
          select(-district , -zone, -residence) %>% 
            tbl_summary(health_risk_associated_with_drinking_untreated_water,
            percent = "row",
            digits = list(
              sex ~ c(0, 2),
              age_group ~ c(0, 2),
              level_education ~ c(0, 2)
            ))



table2 <- table2 %>% 
         as_flex_table()


save_as_docx(table2, path = here("output/table2.docx"))




sum(str_detect(cholera_data$ta, "TA"))


# tbale of the Zone and District 


table3<-awareness_of_heathRisk %>% 
    mutate(district=recode(
      district, 
      "Blantyre_City"="Blantyre"
    )) %>% 
          select(district ,  zone, residence, health_risk_associated_with_drinking_untreated_water) %>% 
            tbl_summary(health_risk_associated_with_drinking_untreated_water,
            percent = "row",
            digits = list(
              district~ c(0, 2),
              zone ~ c(0, 2), 
              residence~ c(0,2)
            ))


table3 <- table3 %>% 
         as_flex_table()


save_as_docx(table3, path = here("output/table3.docx"))



```



## 2.3. 0 Main sources of drinking water during the dry season by District/ Township 

```{r}
drinking_dry<-cholera_data %>% 
  select(district, 
         zone, 
         main_source_of_drinking_water_dry_season)


drinking_dry<- drinking_dry %>% 
  group_by( district, 
           main_source_of_drinking_water_dry_season) %>%
  count(main_source_of_drinking_water_dry_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_dry_season, 
    values_from = n
  )

# replacing NA with Zero 
drinking_dry[is.na(drinking_dry)]<-0


table4<- drinking_dry %>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         community_standpipe=round(community_standpipe/total*100, 2), 
         borehole_1=round(borehole_1/total*100, 2 ), 
         piped_into_dwelling= round(piped_into_dwelling/total*100, 2), 
         piped_into_yard_plot= round(piped_into_yard_plot/total*100, 2), 
         protected_well_1=round(protected_well_1/total*100, 2), 
         unprotected_well_1=round(unprotected_well_1/total*100, 2), 
         other_drinking_source=round(other_drinking_source/total*100, 2), 
         river_stream=round(river_stream/total*100, 2), 
         spring_1=round(spring_1/total*100, 2), 
         dam=round(dam/total/100, 2), 
         bottled_water=round(bottled_water/total*100, 2), 
         tanker_truck_bower=round(tanker_truck_bower/total*100, 2), 
         lake=round(lake/total*100, 2)
         
         )


   table4<-table4 %>%
  rename_with(~ str_replace_all(., "_", " "))




table4<- table4 %>% 
  as_flextable()


save_as_docx(table4, path = here("output/table4.docx"))



drinking_dry_zone<-cholera_data %>% 
  select(zone, 
         main_source_of_drinking_water_dry_season)

drinking_dry_zone<- drinking_dry_zone%>% 
  group_by( zone, 
           main_source_of_drinking_water_dry_season) %>%
  count(main_source_of_drinking_water_dry_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_dry_season, 
    values_from = n
  )


# replacing NA with Zero 
drinking_dry_zone[is.na(drinking_dry_zone)]<-0

    table5<- drinking_dry_zone %>% 
      rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         community_standpipe=round(community_standpipe/total*100, 2), 
         borehole_1=round(borehole_1/total*100, 2 ), 
         piped_into_dwelling= round(piped_into_dwelling/total*100, 2), 
         piped_into_yard_plot= round(piped_into_yard_plot/total*100, 2), 
         protected_well_1=round(protected_well_1/total*100, 2), 
         unprotected_well_1=round(unprotected_well_1/total*100, 2), 
         other_drinking_source=round(other_drinking_source/total*100, 2), 
         river_stream=round(river_stream/total*100, 2), 
         spring_1=round(spring_1/total*100, 2), 
         dam=round(dam/total/100, 2), 
         bottled_water=round(bottled_water/total*100, 2), 
         tanker_truck_bower=round(tanker_truck_bower/total*100, 2), 
         lake=round(lake/total*100, 2)
         
         )
    
    
    
    table5<-table5 %>%
  rename_with(~ str_replace_all(., "_", " "))
    

    
table5<- table5 %>% 
  as_flextable()


save_as_docx(table5, path = here("output/table5.docx"))


```


## 2.4. 0 Main sources of drinking water during the wet season by District

```{r}

wet_drink_district <- cholera_data %>% 
                      select(district, 
                             main_source_of_drinking_water_wet_season)


wet_drink_district<- wet_drink_district %>% 
  group_by( district, 
           main_source_of_drinking_water_wet_season) %>%
  count(main_source_of_drinking_water_wet_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_wet_season, 
    values_from = n
  )




# replacing NA with Zero 
wet_drink_district[is.na(wet_drink_district)]<-0


table6<- wet_drink_district %>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         community_standpipe=round(community_standpipe/total*100, 2), 
         borehole_1=round(borehole_1/total*100, 2 ), 
         piped_into_dwelling= round(piped_into_dwelling/total*100, 2), 
         piped_into_yard_plot= round(piped_into_yard_plot/total*100, 2), 
         protected_well_1=round(protected_well_1/total*100, 2), 
         unprotected_well_1=round(unprotected_well_1/total*100, 2), 
         other_drinking_source=round(other_drinking_source/total*100, 2), 
         river_stream=round(river_stream/total*100, 2), 
         spring_1=round(spring_1/total*100, 2), 
         dam=round(dam/total/100, 2), 
         bottled_water=round(bottled_water/total*100, 2), 
         tanker_truck_bower=round(tanker_truck_bower/total*100, 2), 
         lake=round(lake/total*100, 2)
         
         )


   table6<-table6 %>%
  rename_with(~ str_replace_all(., "_", " "))
   
       
table6<- table6 %>% 
  as_flextable()


save_as_docx(table6, path = here("output/table6.docx"))



# by Zone 


wet_drink_zone <- cholera_data %>% 
                      select(zone, 
                             main_source_of_drinking_water_wet_season)


wet_drink_zone<- wet_drink_zone %>% 
  group_by( zone, 
           main_source_of_drinking_water_wet_season) %>%
  count(main_source_of_drinking_water_wet_season) %>%
    pivot_wider(
    names_from = main_source_of_drinking_water_wet_season, 
    values_from = n
  )




# replacing NA with Zero 
wet_drink_zone[is.na(wet_drink_zone)]<-0


table7<- wet_drink_zone%>% 
  rowwise() %>% 
  mutate(total= sum(across(where(is.numeric))), 
         
         community_standpipe=round(community_standpipe/total*100, 2), 
         borehole_1=round(borehole_1/total*100, 2 ), 
         piped_into_dwelling= round(piped_into_dwelling/total*100, 2), 
         piped_into_yard_plot= round(piped_into_yard_plot/total*100, 2), 
         protected_well_1=round(protected_well_1/total*100, 2), 
         unprotected_well_1=round(unprotected_well_1/total*100, 2), 
         other_drinking_source=round(other_drinking_source/total*100, 2), 
         river_stream=round(river_stream/total*100, 2), 
         spring_1=round(spring_1/total*100, 2), 
         dam=round(dam/total/100, 2), 
         bottled_water=round(bottled_water/total*100, 2), 
         tanker_truck_bower=round(tanker_truck_bower/total*100, 2), 
         lake=round(lake/total*100, 2)
         
         )


   table7<-table7 %>%
  rename_with(~ str_replace_all(., "_", " "))
   
       
table7<- table7 %>% 
  as_flextable()


save_as_docx(table7, path = here("output/table7.docx"))

```

## 2.5.1 Water Treatment at Household by Sex, Level of Education, Religion

```{r}

Water_treat<-cholera_data %>% 
         select(sex, 
                age_group, 
                level_education, 
                religion, 
                treat_drinking_water)


table8<- Water_treat %>% 
  tbl_summary(treat_drinking_water, 
              percent = "row", 
              digits = list(
                sex~ c(0, 2), 
                age_group~c(0,2), 
                level_education~ c(0,2), 
                religion~c(0,2)
              ))

table8<- table8 %>% 
  as_flex_table()


save_as_docx(table8, path = here("output/table8.docx"))


```


## 2.5.2 Water Treatment at Household by District 

```{r}
 


Water_treat_district_zone<-cholera_data %>% 
         select(district, 
                zone, 
                treat_drinking_water)


table9<- Water_treat_district_zone%>% 
  tbl_summary(treat_drinking_water, 
              percent = "row", 
              digits = list(
                district~ c(0, 2), 
                zone~c(0,2)
                
              ))

table9<- table9 %>% 
  as_flex_table()


save_as_docx(table9, path = here("output/table9.docx"))

```


## 2.5.3 if yes, Methods of water treatment by District

```{r}

```


```{r, fig.height=7, fig.width=14}
methods_water <- cholera_data %>% 
               select(
                 sex,
                  age_group, 
                  level_education, 
                  religion, 
                 c(34:41)
               )

 

sex_table<- process_data(methods_water,"sex")
age_group_table<- process_data(methods_water,"age_group")
education_table<- process_data(methods_water,"level_education")
religion_table<- process_data(methods_water,"religion")

sex_table <- sex_table %>% 
  rename(
    "variable" = sex
  )

age_group_table<- age_group_table %>% 
  rename(
    "variable"=age_group
  )


education_table<- education_table %>% 
  rename(
    "variable"=level_education
  )


religion_table<- religion_table %>% 
  rename(
    "variable"=religion
  )


# Combine all tables into one
table10 <- bind_rows(sex_table,
                     age_group_table,
                     education_table,
                     religion_table)



table10<- table10 %>% 
  mutate(
 method_of_water_treatment_boiling= round(method_of_water_treatment_boiling/total*100, 2) ,         
 method_of_water_treatment_ceramic_filter= round(method_of_water_treatment_ceramic_filter/total*100, 2),   
 method_of_water_treatment_filter_with_cloth= round(method_of_water_treatment_filter_with_cloth/total*100, 2),
 method_of_water_treatment_others_methods=round(method_of_water_treatment_others_methods/total*100, 2),    
 method_of_water_treatment_solar_disinfection=round(method_of_water_treatment_solar_disinfection/total*100, 2), 
 method_of_water_treatment_stand_settle=round(method_of_water_treatment_stand_settle/total*100, 2),     
 method_of_water_treatment_use_chlorine= round(method_of_water_treatment_use_chlorine/total*100, 2),
 method_of_water_treatment_use_water_from_tap=round(method_of_water_treatment_use_water_from_tap/total*100, 2) 
    )


table10<- table10 %>%
  rename_with(~ str_replace_all(., "method_of_water_treatment_", " "))


table10<- table10 %>%
  rename_with(~ str_replace_all(., "_", " "))


table10<- table10 %>% 
  as_flextable()


save_as_docx(table10, path = here("output/table10.docx"))

table10
```


```{r}

methods_water_district <- cholera_data %>% 
               select(
                 district, 
                 c(34:41)
               )



tabel11<- methods_water_district %>% 
  pivot_longer(
    cols = (2:9)
  ) %>% 
  drop_na(value) %>% 
  group_by(
    district, 
    name) %>% 
  summarise(value=sum(value)) %>% 
  pivot_wider(
    names_from = name, 
  values_from = value, 
  ) %>% 
  group_by(
    district
  ) %>% 
  rowwise() %>% 
  mutate(total=sum(across(where(is.numeric))))



tabel11<- tabel11 %>% 
mutate(
 method_of_water_treatment_boiling= round(method_of_water_treatment_boiling/total*100, 2) ,         
 method_of_water_treatment_ceramic_filter= round(method_of_water_treatment_ceramic_filter/total*100, 2),   
 method_of_water_treatment_filter_with_cloth= round(method_of_water_treatment_filter_with_cloth/total*100, 2),
 method_of_water_treatment_others_methods=round(method_of_water_treatment_others_methods/total*100, 2),    
 method_of_water_treatment_solar_disinfection=round(method_of_water_treatment_solar_disinfection/total*100, 2), 
 method_of_water_treatment_stand_settle=round(method_of_water_treatment_stand_settle/total*100, 2),     
 method_of_water_treatment_use_chlorine= round(method_of_water_treatment_use_chlorine/total*100, 2),
 method_of_water_treatment_use_water_from_tap=round(method_of_water_treatment_use_water_from_tap/total*100, 2) 
    )




tabel11<- tabel11 %>%
  rename_with(~ str_replace_all(., "method_of_water_treatment_", " "))


tabel11<- tabel11 %>%
  rename_with(~ str_replace_all(., "_", " "))


tabel11<- tabel11%>% 
  as_flextable()


save_as_docx(tabel11, path = here("output/table11.docx"))

```




##2.5.4 Properly chlorination process by district.


```{r}
properly_chro_district <- cholera_data %>% 
            select(district, 
                   chlorination_process_done_correctly)


table12<- properly_chro_district %>% 
  tbl_summary(chlorination_process_done_correctly, 
              percent = "row", 
              digits = list(
                district~c(0,2)
              ))


table12<- table12 %>% 
  as_flex_table()


save_as_docx(table12, path = here("output/table12.docx"))




## by Sex, Age and Education 


properly_chro_demo<- cholera_data %>% 
            select(sex,
                   age_group, 
                   level_education, 
                   religion,
                   chlorination_process_done_correctly)


table13<- properly_chro_demo %>% 
  tbl_summary(chlorination_process_done_correctly, 
              percent = "row", 
              digits = list(
              sex~c(0,2), 
                 age_group~c(0,2), 
                 level_education~c(0,2), 
                 religion~c(0,2)
              ))


table13<- table13 %>% 
  as_flex_table()


save_as_docx(table13, path = here("output/table13.docx"))


```

## 2.5. 5 Frequency of water treatment by Sex, Level of Education, Religion 

```{r}
freq_water_treatment <- cholera_data %>% 
                        select(
                          sex, 
                          age_group, 
                          level_education, 
                          religion, 
                          often_treat_water
                        )



table14<- freq_water_treatment %>% 
  tbl_summary(often_treat_water, 
              digits = list(
                sex~c(0,2), 
                age_group~c(0,2), 
                level_education~c(0,2), 
                religion~c(0,2)
              ))


table14<- table14 %>% 
  as_flex_table()


save_as_docx(table14, path = here("output/table14.docx"))



freq_water_treatment_district <- cholera_data %>% 
                                select(
                                  district,
                                  zone,
                                  often_treat_water
                                )


table15_a<- freq_water_treatment_district %>% 
          tbl_summary(often_treat_water, 
                      digits = list(
                        district~c(0,2), 
                        zone~c(0,2)
                      ))


table15_a<- table15_a %>% 
  as_flex_table()


save_as_docx(table15_a, path = here("output/table15_a.docx"))



```

## 2. 5.6 Access to water treatment product by district 

```{r}

Access_to_water_treatment_pt<-cholera_data %>% 
            select(district, 
                   residence, 
                   difficulties_accessing_water_treatment_products)


table16<- Access_to_water_treatment_pt %>% 
    tbl_summary(difficulties_accessing_water_treatment_products,
                percent = "row",
                digits = list(
                  district~c(0,2), 
                  residence~c(0,2)
                ))


table16<- table16 %>% 
  as_flex_table()

save_as_docx(table16, path = here("output/table16.docx"))



```

## 2. 6.0 Knowledge of cholera calendar year.  By Sex, Level of Education, Religion 

```{r}

knowledge_on_cholera_calender<-cholera_data %>% 
                       select(
                         sex, 
                         age_group, 
                         level_education, 
                         religion, 
                         c(48:51)
                       )

knowledge_on_cholera_calender

sex_table<- process_data(knowledge_on_cholera_calender, "sex")
age_group_table <- process_data(knowledge_on_cholera_calender,
                                "age_group")
education_table <- process_data(knowledge_on_cholera_calender,
                                "level_education")
religion_table <- process_data(knowledge_on_cholera_calender, "religion")

sex_table<- sex_table %>% 
  rename("variable" =sex)


age_group_table<- age_group_table %>%
  rename("variable" = age_group)

education_table<- education_group %>%
  rename("variable" = level_education)

religion_table<- religion_group %>%
  rename("variable" = religion)

table17<- bind_rows(
  sex_table, 
  age_group_table,
  education_table,
  religion_table
)


table17<- table17 %>% 
  mutate(
    knowledge_on_cholera_season_in_winter=round(
    knowledge_on_cholera_season_in_winter/total*100, 2), 
    knowledge_on_cholera_season_in_summer=round(knowledge_on_cholera_season_in_summer/total*100, 2),
   knowledge_on_cholera_season_in_rainy_season =round(knowledge_on_cholera_season_in_rainy_season/total*100, 2),
    knowledge_on_cholera_season_do_not_know=round(knowledge_on_cholera_season_do_not_know/total*100, 2)
    )
  


table17<- table17 %>% 
  rename_with(~ str_replace_all(., "knowledge_on_cholera_season_", ""))


table17<- table17 %>% 
  rename_with(~ str_replace_all(., "_", " "))



table17<- table17 %>% 
  as_flextable()

save_as_docx(table17, path = here("output/table17.docx"))


# Knowledge of cholera calendar year by district




knowledge_on_cholera_calender_district<-cholera_data %>% 
                       select(
                         district, 
                         residence, 
                         zone,
                         c(48:51)
                       )








district_table<- process_data(knowledge_on_cholera_calender_district,
                              "district")

zone_table<- process_data(knowledge_on_cholera_calender_district,
                              "zone")

residence_table<- process_data(knowledge_on_cholera_calender_district,
                              "residence")



district_table<- district_table %>% 
  rename("variable" =district)

zone_table<- zone_table %>% 
  rename("variable" =zone)
residence_table<- residence_table %>% 
  rename("variable" =residence)


table18<- bind_rows(
  district_table,
zone_table,
  residence_table
)


table18<- table18 %>% 
  mutate(
    knowledge_on_cholera_season_in_winter=round(
    knowledge_on_cholera_season_in_winter/total*100, 2), 
    knowledge_on_cholera_season_in_summer=round(knowledge_on_cholera_season_in_summer/total*100, 2),
   knowledge_on_cholera_season_in_rainy_season =round(knowledge_on_cholera_season_in_rainy_season/total*100, 2),
    knowledge_on_cholera_season_do_not_know=round(knowledge_on_cholera_season_do_not_know/total*100, 2)
    )




table18<- table18 %>%
  rename_with(~ str_replace_all(., "knowledge_on_cholera_season_", ""))

table18<- table18 %>%
  rename_with(~ str_replace_all(., "_", " "))



table18<- table18 %>%
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit")


save_as_docx(table18, path = here("output/table18.docx"))


```


## 2. 7. 0 Knowledge of the potential Cause of Cholera.

```{r}

knowledge_on_cholera_cause<-cholera_data %>% 
                       select(sex, 
                              age_group, 
                              level_education, 
                              religion, 
                            contains("potential_causes_of_cholera_"),
                            -contains("potential_causes_of_cholera_other_causes")
                              )



sex_table<- process_data(knowledge_on_cholera_cause,"sex")
age_table<- process_data(knowledge_on_cholera_cause,"age_group")
education_table<- process_data(knowledge_on_cholera_cause,"level_education")
religion_table<- process_data(knowledge_on_cholera_cause,"religion")



sex_table<- sex_table %>% 
  rename("variable"=sex)

age_table<- age_table %>%
  rename("variable"=age_group)

education_table<- education_table %>%
  rename("variable"=level_education)


religion_table<- religion_table %>%
  rename("variable"=religion)


table19<- bind_rows( sex_table, 
                     age_table, 
                     education_table,
                     religion_table) 

table19 %>% 
  mutate(
  potential_causes_of_cholera_affected_by_cholera_germ= round(potential_causes_of_cholera_affected_by_cholera_germ/total*100, 2),                                    
 potential_causes_of_cholera_affected_by_rota_virus =round(
 potential_causes_of_cholera_affected_by_rota_virus/total*100, 2),
                                      
potential_causes_of_cholera_density_population =round(potential_causes_of_cholera_density_population/total*100, 2),                                         
potential_causes_of_cholera_donot_know_1=round( potential_causes_of_cholera_donot_know_1/total*100, 2),                                                 
potential_causes_of_cholera_eating_rotten_food_lack_food_protection_against_contamination= round(potential_causes_of_cholera_eating_rotten_food_lack_food_protection_against_contamination/total*100, 2),
 
 potential_causes_of_cholera_hot_humid_climate=round( potential_causes_of_cholera_hot_humid_climate/total*100, 2),                                          
 potential_causes_of_cholera_illiteracy_ignorance_on_health_education=round(
 potential_causes_of_cholera_illiteracy_ignorance_on_health_education/total*100, 2),
                     
 potential_causes_of_cholera_inadeguate_safe_water_supply_system=round(
   potential_causes_of_cholera_inadeguate_safe_water_supply_system/total*100, 2),
                           
potential_causes_of_cholera_lack_of_safe_drinking_water=round(
  potential_causes_of_cholera_lack_of_safe_drinking_water/total*100, 2),
                                 
potential_causes_of_cholera_not_taking_vaccine=round(
  potential_causes_of_cholera_not_taking_vaccine/total*100, 2),
                                          
potential_causes_of_cholera_not_wash_hands=round(
  potential_causes_of_cholera_not_wash_hands/total*100, 2),
                                              
potential_causes_of_cholera_touching_food_without_clean_hands=round(
  potential_causes_of_cholera_touching_food_without_clean_hands/total*100, 2),
                            
potential_causes_of_cholera_unhygiene_disposal_of_excreta_and_refuse =round(
  potential_causes_of_cholera_unhygiene_disposal_of_excreta_and_refuse/total*100, 2),
                     
potential_causes_of_cholera_unhygiene_living_environment=round(
  potential_causes_of_cholera_unhygiene_living_environment/total*100, 2)
    )

table19<- table19 %>%
  rename_with(~ str_replace_all(., "potential_causes_of_cholera_", ""))

table19<- table19 %>%
  rename_with(~ str_replace_all(., "_", " "))

table19<- table19 %>%
  as_flextable() %>% 
  autofit() %>% 
  set_table_properties(layout = "autofit")


save_as_docx(table19, path = here("output/table19.docx"))
  



 
```

## 2.8. 0 Knowledge of the Prevention Measures of cholera by Sex, Level of Education and Religious Belief.  


```{r}




```

## 2.8. 0 Knowledge of the Prevention Measures of cholera by District 
```{r}





```


## 2. 9.0 Current local measures or campaigns in place to prevent cholera outbreaks by Districts
```{r}




```

# Social and cultural behavior determinants of vaccine uptake 


## 3.1. 0 Aware of Cholera Vaccine by  Age- Group, Sex Level of Education, and 3.1. 1 Aware of Cholera Vaccine by  District and Zone




```{r}
table3.1.0 <- cholera_data |> 
            select(vaccined_with_ocv,age_group,sex,level_education)

grouping_vars <- c("age_group","sex","level_education")


table3.1.0 <-  create_summary_table2(table3.1.0,grouping_vars,"vaccined_with_ocv") |> 
                    as_flextable() |>
                    autofit() |>
                    set_table_properties(layout = "autofit")



save_as_docx( table3.1.0, path = here("output/table3_1_0.docx"))


table3.1.1 <- cholera_data |> 
            select(vaccined_with_ocv,district,residence)

grouping_vars <- c("vaccined_with_ocv","district","residence")


table3.1.1 <-  create_summary_table2(table3.1.1,grouping_vars,"vaccined_with_ocv") |> 
                    as_flextable() |>
                    autofit() |>
                    set_table_properties(layout = "autofit")

table3.1.1 <-  table3.1.1 %>%
         as_flex_table()
  as_flextable() |>
   autofit() |>
  set_table_properties(layout = "autofit")



save_as_docx( table3.1.1, path = here("output/table3_1_1.docx"))


```


## 3.2.0  Believe Cholera Vaccine Prevent Cholera by Sex, Level of Education 

```{r}
table3.2.0 <- cholera_data |> 
            select(ocv_prevent_cholera,age_group,sex,level_education)

grouping_vars <- c("age_group","sex","level_education")


table3.2.0 <-  create_summary_table2(table3.2.0,grouping_vars,"ocv_prevent_cholera") |> 
                    as_flextable() |>
                    autofit() |>
                    set_table_properties(layout = "autofit")



save_as_docx( table3.2.0, path = here("output/table3_2_0.docx"))




```

## 3.2.1  Believe Cholera Vaccine Prevent District and Zone 

```{r}

table3.2.1 <- cholera_data |> 
            select(ocv_prevent_cholera,district,residence)

grouping_vars <- c("district","residence")


table3.2.1 <-  create_summary_table2(table3.2.1,grouping_vars,"ocv_prevent_cholera") |> 
                    as_flextable() |>
                    autofit() |>
                    set_table_properties(layout = "autofit")



save_as_docx( table3.2.1, path = here("output/table3_2_1.docx"))


```

##3.3. 0 Information about Cholera Vaccine  by Sex, Age Group,  Education, Religion, Residence

```{r}
ocv_info <- cholera_data %>% 
               select(
                 sex,
                  age_group, 
                  level_education, 
                  religion,
                 c(139:151)
               )

 

sex_table<- process_data(ocv_info,"sex")
age_group_table<- process_data(ocv_info,"age_group")
education_table<- process_data(ocv_info,"level_education")
religion_table<- process_data(ocv_info,"religion")


sex_table <- sex_table %>% 
  rename(
    "variable" = sex
  )

age_group_table<- age_group_table %>% 
  rename(
    "variable"=age_group
  )


education_table<- education_table %>% 
  rename(
    "variable"=level_education
  )


religion_table<- religion_table %>% 
  rename(
    "variable"=religion
  )


# Combine all tables into one
table3.3.0 <- bind_rows(sex_table,
                     age_group_table,
                     education_table,
                     religion_table)



table3.3.0 <- table3.3.0 %>% 
  mutate(
 ocv_information_social_media= round(ocv_information_social_media/total*100, 2) ,         
ocv_information_radio= round(ocv_information_radio/total*100, 2),   

 ocv_information_print_media= round(ocv_information_print_media/total*100, 2),

 ocv_information_religious_leaders=round(ocv_information_religious_leaders/total*100, 2),    
 ocv_information_government=round(ocv_information_government/total*100, 2), 

 ocv_information_other_information = round(ocv_information_other_information/total*100, 2),     

 ocv_information_healthcare_providers= round(ocv_information_healthcare_providers/total*100, 2),

 ocv_information_friends_family  = round(ocv_information_friends_family/total*100, 2),

ocv_information_internet=round(ocv_information_internet/total*100, 2),

ocv_information_community_leaders = round(ocv_information_community_leaders/total*100, 2),
ocv_information_communication_campaign = round(ocv_information_communication_campaign/total*100, 2)#,
#other_source_of_ocv =round(other_source_of_ocv/total*100, 2)
    )




table3.3.0 <- table3.3.0 %>%
  rename_with(~ str_replace_all(., "ocv_information_", " "))

table3.3.0 <- table3.3.0 %>%
  rename_with(~ str_replace_all(., "_", " "))


table3.3.0 <- table3.3.0 %>% 
  as_flextable() |> 
   autofit() |> 
  set_table_properties(layout = "autofit")

table3.3.0

save_as_docx(table3.3.0, path = here("output/table3_3_0.docx"))



```

```{r}
residence_table
```


## 3.3. 1 Information about Cholera Vaccine  by  District and Zone 

```{r}
ocv_info <- cholera_data %>% 
               select(
                 district,
                 zone,
                 residence,
                 c(139:151)
               )

district_table<- process_data(ocv_info,"district")
age_group_table<- process_data(ocv_info,"zone")
residence_table<- process_data(ocv_info,"residence")

district_table <- district_table %>% 
  rename(
    "variable" = district
  )

zone_table<- age_group_table %>% 
  rename(
    "variable"= zone
  )


residence_table <- residence_table %>% 
  rename(
    "variable"=residence
  )

# Combine all tables into one
table3.3.1 <- bind_rows(district_table,
                     zone_table,
                     residence_table)



table3.3.1 <- table3.3.1 %>% 
  mutate(
 ocv_information_social_media= round(ocv_information_social_media/total*100, 2) ,         
ocv_information_radio= round(ocv_information_radio/total*100, 2),   

 ocv_information_print_media= round(ocv_information_print_media/total*100, 2),

 ocv_information_religious_leaders=round(ocv_information_religious_leaders/total*100, 2),    
 ocv_information_government=round(ocv_information_government/total*100, 2), 

 ocv_information_other_information = round(ocv_information_other_information/total*100, 2),     

 ocv_information_healthcare_providers= round(ocv_information_healthcare_providers/total*100, 2),

 ocv_information_friends_family  = round(ocv_information_friends_family/total*100, 2),

ocv_information_internet=round(ocv_information_internet/total*100, 2),

ocv_information_community_leaders = round(ocv_information_community_leaders/total*100, 2),
ocv_information_communication_campaign = round(ocv_information_communication_campaign/total*100, 2)#,
#other_source_of_ocv =round(other_source_of_ocv/total*100, 2)
    )




table3.3.1 <- table3.3.1 %>%
  rename_with(~ str_replace_all(., "ocv_information_", " "))

table3.3.1 <- table3.3.1 %>%
  rename_with(~ str_replace_all(., "_", " "))


table3.3.1 <- table3.3.1 %>% 
  as_flextable() |> 
   autofit() |> 
  set_table_properties(layout = "autofit")

table3.3.1

save_as_docx(table3.3.1, path = here("output/table3_3_1.docx"))


```



## 3. 4. 0 Safe of Cholera Vaccine by Sex Age Group Education and Religion 

```{r}

table3.4.0 <- cholera_data %>%
  select(sex, age_group, level_education, religion, safe_vaccine)

grouping_vars <- c("age_group","sex","level_education","religion")


table3.4.0 <-  create_summary_table2(table3.4.0,grouping_vars,"safe_vaccine") 

table3.4.0

table3.4.0 <- table3.4.0 |> 
          as_flextable() |>
          autofit() |>
          set_table_properties(layout = "autofit")



save_as_docx( table3.4.0, path = here("output/table3_4_0.docx"))


```


##3. 4. 1 Safe of Cholera Vaccine by District and Zone 

```{r}
table3.4.1 <- cholera_data |> 
            select(safe_vaccine,district,zone) %>% 
            tbl_summary(safe_vaccine,
            percent = "row",
            digits = list(
              district~ c(0, 2),
              zone ~ c(0, 2)
            ))


 
table3.4.1 <-  table3.4.1 %>% 
         as_flex_table() |>  
  as_flextable() |> 
   autofit() |> 
  set_table_properties(layout = "autofit")


save_as_docx( table3.1.1, path = here("output/table3_4_1.docx"))

table3.4.1


```

## 3. 5. 0 Community Influence decision about vaccination by District and Zone 

```{r}

cI_info <- cholera_data %>% 
               select(
                 district,
                 zone,
                 residence,
                 c(119:123)
               )

district_table<- process_data(cI_info,"district")
age_group_table<- process_data(cI_info,"zone")
residence_table<- process_data(cI_info,"residence")

district_table <- district_table %>% 
  rename(
    "variable" = district
  )

zone_table<- age_group_table %>% 
  rename(
    "variable"= zone
  )


residence_table <- residence_table %>% 
  rename(
    "variable"=residence
  )

# Combine all tables into one
table3.5.0 <- bind_rows(district_table,
                     zone_table,
                     residence_table)



table3.5.0  <- table3.5.0  %>% 
  mutate(
 decision_about_getting_vaccinated_cultural_traditional= round(decision_about_getting_vaccinated_cultural_traditional/total*100, 2) , 
 
decision_about_getting_vaccinated_religious= round(decision_about_getting_vaccinated_religious/total*100, 2),   

 decision_about_getting_vaccinated_family_pressure= round(decision_about_getting_vaccinated_family_pressure/total*100, 2),

 decision_about_getting_vaccinated_none_2=round(decision_about_getting_vaccinated_none_2/total*100, 2),    

decision_about_getting_vaccinated_other_decision=round(decision_about_getting_vaccinated_other_decision/total*100, 2), 

)


table3.5.0  <- table3.5.0  %>%
  rename_with(~ str_replace_all(., "decision_about_getting_vaccinated_", " "))

table3.5.0  <- table3.5.0  %>%
  rename_with(~ str_replace_all(., "_", " "))


table3.5.0  <- table3.5.0  |>  
  as_flextable() |> 
   autofit() |> 
  set_table_properties(layout = "autofit")

table3.5.0 

save_as_docx(table3.5.0 , path = here("output/table3_5_0.docx"))
       


```



## 3. 6. 0 Difficult in access cholera vaccination by Sex, Education and Religion  

```{r}

table3.6.0 <- cholera_data %>%
  select(sex, age_group, level_education, religion, ocv_access) %>%
  tbl_summary(
    by = ocv_access,
    statistic = list(
      sex ~ "{n} ({p}%)",
      age_group ~ "{n} ({p}%)",
      level_education ~ "{n} ({p}%)",
      religion ~ "{n} ({p}%)"
    ),
    digits = list(
      sex ~ c(0, 2),
      age_group ~ c(0, 2),
      level_education ~ c(0, 2),
      religion ~ c(0, 2)
    ),
    percent = "row"
  ) %>%
  modify_header(label = "**Demographic Variable**") %>%
  bold_labels()

# Convert to a flextable for Word export
table_safe_combined <- table3.6.0 %>%
  as_flex_table()

# Save as a Word document
save_as_docx(table3.6.0, path = here("output/table3_6_0.docx"))

table3.6.0





```


## 3. 6. 1 Difficult in access cholera vaccination by District 


```{r}

table3.6.1 <- cholera_data |> 
            select(ocv_prevent_cholera,district) %>% 
            tbl_summary(ocv_prevent_cholera,
            percent = "row",
            digits = list(
              district~ c(0, 2)
            ))


 
table3.6.1 <-  table3.6.1 %>% 
         as_flex_table()


save_as_docx( table3.6.1, path = here("output/table3_6_1.docx"))

table3.6.1


```



##3. 7. 0 OCV status by Sex, Age Group, Education and Religious 

```{r}
table3.7.0 <- cholera_data |> 
  select(sex,age_group,level_education,religion,received_ocv,residence)

grouping_vars <- c("age_group","sex","level_education","religion")


table3.7.0 <-  create_summary_table2(table3.7.0,grouping_vars,"received_ocv") 

table3.7.0

table3.7.0 <- table3.7.0 |> 
          as_flextable() |>
          autofit() |>
          set_table_properties(layout = "autofit")



save_as_docx( table3.7.0, path = here("output/table3_7_0.docx"))



table3.7.1 <- cholera_data |> 
  select(received_ocv,district,residence)

grouping_vars <- c("district","residence")


table3.7.1 <-  create_summary_table2(table3.7.1,grouping_vars,"received_ocv") 

table3.7.1

table3.7.1 <- table3.7.1 |> 
          as_flextable() |>
          autofit() |>
          set_table_properties(layout = "autofit")



save_as_docx( table3.7.1, path = here("output/table3_7_1.docx"))

```


## 3. 8. 0 Family Members vaccinated by District and Zone 
```{r}
table3.8.0 <- cholera_data |> 
            select(family_members_vaccinated,district,residence)


grouping_vars <- c("district","residence")


table3.8.0 <-  create_summary_table2(table3.8.0,grouping_vars,"family_members_vaccinated") 

table3.8.0

table3.8.0 <- table3.8.0 |> 
          as_flextable() |>
          autofit() |>
          set_table_properties(layout = "autofit")



save_as_docx( table3.8.0, path = here("output/table3_8_0.docx"))


```


## 3. 9. 0 Willingness to get vaccinated in the Future OCV by Sex, Age Group and Education 

```{r}

table3.4.1 <- cholera_data |> 
            select(safe_vaccine,district,zone) %>% 
            tbl_summary(safe_vaccine,
            percent = "row",
            digits = list(
              district~ c(0, 2),
              zone ~ c(0, 2)
            ))


 
table3.4.1 <-  table3.4.1 %>% 
         as_flex_table() |>  
  as_flextable() |> 
   autofit() |> 
  set_table_properties(layout = "autofit")


save_as_docx( table3.1.1, path = here("output/table3_4_1.docx"))

table3.4.1


```

## 3. 5. 0 Community Influence decision about vaccination by District and Zone 

```{r}

cI_info <- cholera_data %>% 
               select(
                 district,
                 zone,
                 residence,
                 c(119:123)
               )

district_table<- process_data(cI_info,"district")
age_group_table<- process_data(cI_info,"zone")
residence_table<- process_data(cI_info,"residence")

district_table <- district_table %>% 
  rename(
    "variable" = district
  )

zone_table<- age_group_table %>% 
  rename(
    "variable"= zone
  )


residence_table <- residence_table %>% 
  rename(
    "variable"=residence
  )

# Combine all tables into one
table3.5.0 <- bind_rows(district_table,
                     zone_table,
                     residence_table)



table3.5.0  <- table3.5.0  %>% 
  mutate(
 decision_about_getting_vaccinated_cultural_traditional= round(decision_about_getting_vaccinated_cultural_traditional/total*100, 2) , 
 
decision_about_getting_vaccinated_religious= round(decision_about_getting_vaccinated_religious/total*100, 2),   

 decision_about_getting_vaccinated_family_pressure= round(decision_about_getting_vaccinated_family_pressure/total*100, 2),

 decision_about_getting_vaccinated_none_2=round(decision_about_getting_vaccinated_none_2/total*100, 2),    

decision_about_getting_vaccinated_other_decision=round(decision_about_getting_vaccinated_other_decision/total*100, 2), 

)


table3.5.0  <- table3.5.0  %>%
  rename_with(~ str_replace_all(., "decision_about_getting_vaccinated_", " "))

table3.5.0  <- table3.5.0  %>%
  rename_with(~ str_replace_all(., "_", " "))


table3.5.0  <- table3.5.0  |>  
  as_flextable() |> 
   autofit() |> 
  set_table_properties(layout = "autofit")

table3.5.0 

save_as_docx(table3.5.0 , path = here("output/table3_5_0.docx"))

```


## 3. 9. 1 Willingness to get vaccinated in the Future OCV by District and Zone 

```{r}
table3.9.1 <- cholera_data |> 
            select(will_to_get_vaccinated,age_group,sex,level_education,religion)


grouping_vars <- c("age_group","sex","level_education","religion")


table3.9.1 <-  create_summary_table2(table3.9.1,grouping_vars,"will_to_get_vaccinated") 

table3.9.1

table3.9.1 <- table3.9.1 |> 
          as_flextable() |>
          autofit() |>
          set_table_properties(layout = "autofit")



save_as_docx( table3.9.1, path = here("output/table3_9_1.docx"))

```


## 3. 10. 0 Recommend a Family member to get vaccinated by District and Zone 

```{r}
table3.10.0 <- cholera_data %>% 
               select(
                 district,
                 zone,
                 residence,
                 recommend_ocv_to_family
               ) |> 
  tbl_summary(recommend_ocv_to_family,
              percent = "row",
              digits = list(
                district~c(0,2),
                zone~c(0,2)
              ))
table3.10.0

```


# 4. 0 . Availability and use of sanitary services and infrastructure for cholera prevention



# Percentage of households that have toilets

## 1.	Do you have toilet?

```{r}

knitr::opts_chunk$set(tidy = TRUE, collapse = TRUE, rows.print = 12)

available_toilet<- cholera_data %>% 
            select(district, 
                   residence, 
                   toilet_facility_avaiable)

              
toilet_dis_table<- available_toilet %>% 
  group_by(district) %>%
  count(toilet_facility_avaiable) %>% 
  drop_na(toilet_facility_avaiable) %>% 
  pivot_wider(names_from = toilet_facility_avaiable,
              values_from = n) %>% 
  # adorn_totals("row") %>%
  mutate(total=available+not_available, 
         available= round( available/total*100,2), 
         not_available=round( not_available/total*100,2)) %>% 
  rename("Background_charateristic" = district)



toilet_res_table<- available_toilet %>% 
  group_by(residence) %>%
  count(toilet_facility_avaiable) %>% 
  drop_na(toilet_facility_avaiable) %>% 
  pivot_wider(names_from = toilet_facility_avaiable,
              values_from = n) %>% 
  adorn_totals("row") %>%
  mutate(total=available+not_available, 
         available= round( available/total*100,2), 
         not_available=round( not_available/total*100,2)) %>% 
  rename("Background_charateristic" = residence)



table20<-rbind(toilet_dis_table, toilet_res_table) 

empty_row1 <- data.frame(Background_charateristic= "District",
                        available = NA,
                        not_available = NA, 
                        total = NA)
  
empty_row2 <- data.frame(Background_charateristic= "Residence",
                        available = NA,
                        not_available = NA, 
                        total = NA)


table20<- rbind(empty_row1, table20[1:7, ],
      empty_row2, table20[8:nrow(table20), ])

table20<- table20 %>%
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )


save_as_docx(table20, path= here("output/table20.docx"))
  



```



## District from the toilets


```{r}

available_toilet_demo<- cholera_data %>% 
            select(sex, 
                   level_education,
                   ethnicity,
                   toilet_facility_avaiable)


sex_table<- create_summary_table(available_toilet_demo, "sex", 
                     "toilet_facility_avaiable")
leduction_table<- create_summary_table(available_toilet_demo, "level_education",
                     "toilet_facility_avaiable")
ethincity_table<- create_summary_table(available_toilet_demo,
                                       "ethnicity",
                     "toilet_facility_avaiable", 
                      sum = T)

toilet_table_demo<-rbind(sex_table, leduction_table, ethincity_table)


toilet_table<-toilet_table_demo %>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )

save_as_docx(toilet_table, path = here("output/toilet_table.docx"))


```



## 2.	What type of toilet facility do members of your     household usually use? 


```{r}





```




## 3.	Do you have Refuse pit?


```{r}

refuse_pit<- cholera_data %>% 
            select(district, 
                   residence, 
                   soild_waste_disposal,
                   bath_shelter_bathroom)


refuse_pit_dis_table<- refuse_pit %>%
             create_summary_table("district", "soild_waste_disposal")

refuse_pit_res_table <- refuse_pit %>% 
         create_summary_table("residence",
                              "soild_waste_disposal",
                              sum = T)


refuse_pit_table<-rbind(refuse_pit_dis_table,
                        refuse_pit_res_table)


bath_shelter_dis_table<- refuse_pit %>%
             create_summary_table("district", "bath_shelter_bathroom")

bath_shelter_res_table <- refuse_pit %>%
    create_summary_table("residence",
                              "bath_shelter_bathroom",
                              sum = T)


bath_shelter_table<-rbind(bath_shelter_dis_table,
                          bath_shelter_res_table)

bath_shelter_table <- bath_shelter_table %>% 
  rename("Bath_available"=available_percent, 
         "Bath_not_available"=not_available_percent)



refuse_pit_table <- refuse_pit_table %>%
  rename("Refuse_pit_available"=available_percent, 
         "Refuse_pit_not_available"=not_available_percent)

merge(refuse_pit_table, bath_shelter_table,
      by.x = "Background_charateristic")
  # flextable() %>%
  # autofit()
  # set_table_properties(layout = "autofit") %>%
  # height_all(height =  0.5, unit = "in" ) %>%
  # save_as_docx(path = here("output/refuse_pit_table.docx"))


refuse_pit_table1<-merge.data.frame(refuse_pit_table,
                                    bath_shelter_table) %>% 
   select(Background_characteristic,
         Refuse_pit_available, Refuse_pit_not_available,
         Bath_available, Bath_not_available, total)

Refuse_pit_table1<- refuse_pit_table1 %>% 
  flextable() %>%
  autofit() %>%
  set_table_properties(layout = "autofit") %>%
  height_all(height =  0.5, unit = "in" )


save_as_docx(Refuse_pit_table1, path = here("output/Refuse_pit_table1.docx"))
  
  
```

## 4.	Do you have Bath Shelter with good drainage?


```{r}

```



## 5.	the pit latrine Condtion by District?




```{r}

Pit_condition <- cholera_data %>% 
                   select(district,
                          residence, 
                          pit_condition)


stack_bar_pit_conition<- Pit_condition %>% 
  group_by(district, pit_condition) %>%
  summarise(n=n()) %>% 
  drop_na(pit_condition) %>%
  pivot_wider(names_from = pit_condition,
              values_from = n) %>% 
  mutate(total=not_pit+overflowing+properly_maintained, 
         not_pit= round(not_pit/total*100, 2), 
         overflowing=round(overflowing/total*100, 2), 
       properly_maintained=round(properly_maintained/total*100, 2)) %>% 
  select(district, not_pit, overflowing, properly_maintained) %>% 
  pivot_longer(cols = c(not_pit, overflowing, properly_maintained),
               names_to = "Pit_condition",
               values_to = "Percentage") %>% 
   mutate(Pit_condition = factor(Pit_condition, 
                                 levels = c("properly_maintained",
                                            "overflowing",
                                            "not_pit"))) %>% 
  ggplot(aes(x=district, y=Percentage, fill=Pit_condition))+
  geom_col()+
  coord_flip()+
  scale_fill_manual(values = c( "properly_maintained" = "green",
                                "overflowing" = "yellow",
                                "not_pit" = "red" )) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = "black"), 
        axis.text.y = element_text(size = 12, colour = "black"), 
        axis.title.y = element_text(size = 14, colour = "black"), 
        axis.title.x = element_text(size = 14, colour = "black"))+
  labs(y = "Percentage") +
  ggtitle("Pit Condition by District")+
  geom_text(aes(label = paste0(Percentage,"%")), 
            position = position_stack(vjust = 0.5))


ggsave("output/stack_bar_pit_conition.png", 
       plot = stack_bar_pit_conition,
       width = 10, height = 10, units = "in", dpi = 300, 
       bg="white")





```


## 6.	Pit condition by residence 


```{r}

 stack_bar_residence<- Pit_condition %>% 
  mutate(residence = recode(residence,
                        "in_land"="in land", 
                        "lake_share" = "Lake Shore")) %>%
  group_by(residence, pit_condition) %>%
  summarise(n=n()) %>% 
  drop_na(pit_condition) %>%
  pivot_wider(names_from = pit_condition,
              values_from = n) %>% 
  mutate(total=not_pit+overflowing+properly_maintained, 
         not_pit= round(not_pit/total*100, 2), 
         overflowing=round(overflowing/total*100, 2), 
       properly_maintained=round(properly_maintained/total*100, 2)) %>% 
  select(residence, not_pit, overflowing, properly_maintained) %>% 
  pivot_longer(cols = c(not_pit, overflowing, properly_maintained),
               names_to = "Pit_condition",
               values_to = "Percentage") %>% 
   mutate(Pit_condition = factor(Pit_condition, 
                                 levels = c("properly_maintained",
                                            "overflowing",
                                            "not_pit"))) %>% 
  ggplot(aes(x=residence, y=Percentage, fill=Pit_condition))+
  geom_col()+
  coord_flip()+
  scale_fill_manual(values = c( "properly_maintained" = "green",
                                "overflowing" = "yellow",
                                "not_pit" = "red" )) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = "black"), 
        axis.text.y = element_text(size = 12, colour = "black"), 
        axis.title.y = element_text(size = 14, colour = "black"), 
        axis.title.x = element_text(size = 14, colour = "black"))+
  labs(y = "Percentage", 
       x="Residence") +
  ggtitle("Pit Condition by Residence")+
  geom_text(aes(label = paste0(Percentage,"%")), 
            position = position_stack(vjust = 0.5))


ggsave("output/stack_bar_residenc.png", 
       plot = stack_bar_residence,
       width = 10, height = 10, units = "in", dpi = 300, 
       bg="white")







```


```{r}




```





## 7.	How often do you wash hands with soap after using the toilet or handling food?


```{r}

Pit_condition %>% 
  group_by(district, pit_condition) %>%
  summarise(n=n()) %>% 
  drop_na(pit_condition) %>%
  pivot_wider(names_from = pit_condition,
              values_from = n) %>% 
  mutate(total=not_pit+overflowing+properly_maintained, 
         not_pit= round(not_pit/total*100, 2), 
         overflowing=round(overflowing/total*100, 2), 
         properly_maintained=round(properly_maintained/total*100, 2)) %>% 
  select(district, not_pit, overflowing, properly_maintained) %>% 
  pivot_longer(cols = c(not_pit, overflowing, properly_maintained),
               names_to = "Pit_condition",
               values_to = "Percentage") %>% 

ggplot(aes(x = district, y = Percentage, color = Pit_condition)) +
  geom_point(size = 5) +
  geom_line(aes(group = district), size = 1) +
  coord_flip() +
  theme_minimal() +
  scale_color_manual(values = c("not_pit" = "red",
                                "overflowing" = "yellow",
                                "properly_maintained" = "green")) +
  labs(y = "Percentage", title = "Pit Condition by District")




```

## 8.	Hand washing facility by district and residence


```{r}

Household_handwashing<- cholera_data %>% 
            select(district, 
                   residence, 
                   household_handwashing_facility)










```


## 9.	Do people in this community consistently use the available sanitation facilities?



## 10.	What are the common reasons for not using available sanitary facilities? 


```{r}



```


## 11.	How do people manage when sanitation facilities are unavailable?



